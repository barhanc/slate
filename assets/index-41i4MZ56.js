(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))d(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const r of c.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&d(r)}).observe(document,{childList:!0,subtree:!0});function o(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function d(i){if(i.ep)return;i.ep=!0;const c=o(i);fetch(i.href,c)}})();const e=new fabric.Canvas("c",{backgroundColor:"#f0f0f0",selection:!0,preserveObjectStacking:!0});let m=!1,p=0,v=0;const O=50;let s=[],a=[],b=!1;const f=document.getElementById("context-bar");function y(){e.setWidth(window.innerWidth),e.setHeight(window.innerHeight),e.renderAll()}window.addEventListener("resize",y);y();e.on("mouse:wheel",function(t){const n=t.e.deltaY;let o=e.getZoom();o*=.999**n,o>20&&(o=20),o<.1&&(o=.1),e.zoomToPoint({x:t.e.offsetX,y:t.e.offsetY},o),t.e.preventDefault(),t.e.stopPropagation()});e.on("mouse:down",function(t){const n=t.e;n.altKey===!0&&(m=!0,e.selection=!1,p=n.clientX,v=n.clientY)});e.on("mouse:move",function(t){if(m){const n=t.e,o=e.viewportTransform;o[4]+=n.clientX-p,o[5]+=n.clientY-v,e.requestRenderAll(),p=n.clientX,v=n.clientY}});e.on("mouse:up",function(t){m&&(e.setViewportTransform(e.viewportTransform),m=!1,e.defaultCursor="default",e.selection=!0)});function l(){const t=e.getActiveObject();if(!t){f.classList.remove("visible"),f.style.display="none";return}const n=t.getBoundingRect(),o=60,d=50,i=220;let c=n.top-d-o,r=n.left+n.width/2-i/2;c<10&&(c=n.top+n.height+o),r<10&&(r=10),r+i>window.innerWidth&&(r=window.innerWidth-i-10),f.style.top=`${c}px`,f.style.left=`${r}px`,f.style.display="flex"}e.on("selection:created",l);e.on("selection:updated",l);e.on("selection:cleared",l);e.on("object:moving",l);e.on("object:scaling",l);e.on("object:rotating",l);e.on("mouse:up",l);e.on("mouse:wheel",l);document.getElementById("ctx-eraser").onclick=()=>{};document.getElementById("ctx-delete").onclick=()=>{const t=e.getActiveObject();t&&(t.type==="activeSelection"?(t.forEachObject(n=>e.remove(n)),e.discardActiveObject()):e.remove(t),e.requestRenderAll())};document.getElementById("ctx-back").onclick=()=>{const t=e.getActiveObject();t&&(e.sendToBack(t),e.discardActiveObject(),e.requestRenderAll(),e.fire("object:modified"))};document.getElementById("ctx-copy").onclick=()=>{const t=e.getActiveObject();t&&t.clone(function(n){e.discardActiveObject(),n.set({left:n.left+20,top:n.top+20,evented:!0}),n.type==="activeSelection"?(n.canvas=e,n.forEachObject(function(o){e.add(o)}),n.setCoords()):e.add(n),e.setActiveObject(n),e.requestRenderAll()})};document.getElementById("ctx-flip-h").onclick=()=>{const t=e.getActiveObject();t&&(t.set("flipX",!t.flipX),e.requestRenderAll(),e.fire("object:modified"))};document.getElementById("ctx-download").onclick=()=>{const t=e.getActiveObject();if(t){const n=t.toDataURL({format:"png",multiplier:4}),o=document.createElement("a");o.download="image.png",o.href=n,document.body.appendChild(o),o.click(),document.body.removeChild(o)}};document.getElementById("imgLoader").addEventListener("change",function(t){const n=t.target.files[0];if(!n)return;const o=new FileReader;o.onload=function(d){fabric.Image.fromURL(d.target.result,function(i){i.width>800&&i.scaleToWidth(800);const c=e.getVpCenter();i.set({left:c.x,top:c.y,originX:"center",originY:"center"}),e.add(i),e.setActiveObject(i)})},o.readAsDataURL(n),t.target.value=""});document.getElementById("btn-undo").onclick=j;document.getElementById("btn-redo").onclick=w;document.getElementById("btn-clear").onclick=()=>{confirm("Clear entire canvas?")&&(e.clear(),e.setBackgroundColor("#f0f0f0",e.renderAll.bind(e)),u())};function u(){if(b)return;a.length>0&&(a=[],g());const t=JSON.stringify(e.toJSON());s.push(t),s.length>O&&s.shift(),g()}function h(t){b=!0,e.loadFromJSON(t,function(){e.renderAll(),b=!1})}function j(){if(s.length<=1)return;const t=s.pop();a.push(t);const n=s[s.length-1];h(n),g()}function w(){if(a.length===0)return;const t=a.pop();s.push(t),h(t),g()}function g(){document.getElementById("btn-undo").disabled=s.length<=1,document.getElementById("btn-redo").disabled=a.length===0}u();e.on("object:added",u);e.on("object:modified",u);e.on("object:removed",u);
