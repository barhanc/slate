var nn=Object.defineProperty,_l=Object.getOwnPropertyDescriptor,El=Object.getOwnPropertyNames,xl=Object.prototype.hasOwnProperty,Al=(n=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(n,{get:(o,l)=>(typeof require<"u"?require:o)[l]}):n)(function(n){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+n+'" is not supported')}),D=(n,o)=>()=>(n&&(o=n(n=0)),o),Ut=(n,o)=>{for(var l in o)nn(n,l,{get:o[l],enumerable:!0})},Ol=(n,o,l,i)=>{if(o&&typeof o=="object"||typeof o=="function")for(let u of El(o))!xl.call(n,u)&&u!==l&&nn(n,u,{get:()=>o[u],enumerable:!(i=_l(o,u))||i.enumerable});return n},Yt=n=>Ol(nn({},"__esModule",{value:!0}),n),_t,Fe,dt,Hi,wa,ba=D(()=>{_t=new Map,Fe=[],dt=(n,o,l)=>{if(o&&typeof o.init=="function"&&typeof o.createInferenceSessionHandler=="function"){let i=_t.get(n);if(i===void 0)_t.set(n,{backend:o,priority:l});else{if(i.priority>l)return;if(i.priority===l&&i.backend!==o)throw new Error(`cannot register backend "${n}" using priority ${l}`)}if(l>=0){let u=Fe.indexOf(n);u!==-1&&Fe.splice(u,1);for(let p=0;p<Fe.length;p++)if(_t.get(Fe[p]).priority<=l){Fe.splice(p,0,n);return}Fe.push(n)}return}throw new TypeError("not a valid backend")},Hi=async n=>{let o=_t.get(n);if(!o)return"backend not found.";if(o.initialized)return o.backend;if(o.aborted)return o.error;{let l=!!o.initPromise;try{return l||(o.initPromise=o.backend.init(n)),await o.initPromise,o.initialized=!0,o.backend}catch(i){return l||(o.error=`${i}`,o.aborted=!0),o.error}finally{delete o.initPromise}}},wa=async n=>{let o=n.executionProviders||[],l=o.map(y=>typeof y=="string"?y:y.name),i=l.length===0?Fe:l,u,p=[],c=new Set;for(let y of i){let b=await Hi(y);typeof b=="string"?p.push({name:y,err:b}):(u||(u=b),u===b&&c.add(y))}if(!u)throw new Error(`no available backend found. ERR: ${p.map(y=>`[${y.name}] ${y.err}`).join(", ")}`);for(let{name:y,err:b}of p)l.includes(y)&&console.warn(`removing requested execution provider "${y}" from session options because it is not available: ${b}`);let d=o.filter(y=>c.has(typeof y=="string"?y:y.name));return[u,new Proxy(n,{get:(y,b)=>b==="executionProviders"?d:Reflect.get(y,b)})]}}),Il=D(()=>{ba()}),va,Sl=D(()=>{va="1.23.2"}),Sr,oe,Ca=D(()=>{Sl(),Sr="warning",oe={wasm:{},webgl:{},webgpu:{},versions:{common:va},set logLevel(n){if(n!==void 0){if(typeof n!="string"||["verbose","info","warning","error","fatal"].indexOf(n)===-1)throw new Error(`Unsupported logging level: ${n}`);Sr=n}},get logLevel(){return Sr}},Object.defineProperty(oe,"logLevel",{enumerable:!0})}),Z,Ul=D(()=>{Ca(),Z=oe}),Ta,_a,Bl=D(()=>{Ta=(n,o)=>{let l=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);l.width=n.dims[3],l.height=n.dims[2];let i=l.getContext("2d");if(i!=null){let u,p;o?.tensorLayout!==void 0&&o.tensorLayout==="NHWC"?(u=n.dims[2],p=n.dims[3]):(u=n.dims[3],p=n.dims[2]);let c=o?.format!==void 0?o.format:"RGB",d=o?.norm,y,b;d===void 0||d.mean===void 0?y=[255,255,255,255]:typeof d.mean=="number"?y=[d.mean,d.mean,d.mean,d.mean]:(y=[d.mean[0],d.mean[1],d.mean[2],0],d.mean[3]!==void 0&&(y[3]=d.mean[3])),d===void 0||d.bias===void 0?b=[0,0,0,0]:typeof d.bias=="number"?b=[d.bias,d.bias,d.bias,d.bias]:(b=[d.bias[0],d.bias[1],d.bias[2],0],d.bias[3]!==void 0&&(b[3]=d.bias[3]));let v=p*u,C=0,_=v,O=v*2,R=-1;c==="RGBA"?(C=0,_=v,O=v*2,R=v*3):c==="RGB"?(C=0,_=v,O=v*2):c==="RBG"&&(C=0,O=v,_=v*2);for(let $=0;$<p;$++)for(let j=0;j<u;j++){let M=(n.data[C++]-b[0])*y[0],U=(n.data[_++]-b[1])*y[1],N=(n.data[O++]-b[2])*y[2],L=R===-1?255:(n.data[R++]-b[3])*y[3];i.fillStyle="rgba("+M+","+U+","+N+","+L+")",i.fillRect(j,$,1,1)}if("toDataURL"in l)return l.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},_a=(n,o)=>{let l=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),i;if(l!=null){let u,p,c;o?.tensorLayout!==void 0&&o.tensorLayout==="NHWC"?(u=n.dims[2],p=n.dims[1],c=n.dims[3]):(u=n.dims[3],p=n.dims[2],c=n.dims[1]);let d=o!==void 0&&o.format!==void 0?o.format:"RGB",y=o?.norm,b,v;y===void 0||y.mean===void 0?b=[255,255,255,255]:typeof y.mean=="number"?b=[y.mean,y.mean,y.mean,y.mean]:(b=[y.mean[0],y.mean[1],y.mean[2],255],y.mean[3]!==void 0&&(b[3]=y.mean[3])),y===void 0||y.bias===void 0?v=[0,0,0,0]:typeof y.bias=="number"?v=[y.bias,y.bias,y.bias,y.bias]:(v=[y.bias[0],y.bias[1],y.bias[2],0],y.bias[3]!==void 0&&(v[3]=y.bias[3]));let C=p*u;if(o!==void 0&&(o.format!==void 0&&c===4&&o.format!=="RGBA"||c===3&&o.format!=="RGB"&&o.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let _=4,O=0,R=1,$=2,j=3,M=0,U=C,N=C*2,L=-1;d==="RGBA"?(M=0,U=C,N=C*2,L=C*3):d==="RGB"?(M=0,U=C,N=C*2):d==="RBG"&&(M=0,N=C,U=C*2),i=l.createImageData(u,p);for(let F=0;F<p*u;O+=_,R+=_,$+=_,j+=_,F++)i.data[O]=(n.data[M++]-v[0])*b[0],i.data[R]=(n.data[U++]-v[1])*b[1],i.data[$]=(n.data[N++]-v[2])*b[2],i.data[j]=L===-1?255:(n.data[L++]-v[3])*b[3]}else throw new Error("Can not access image data");return i}}),Gt,Ea,xa,Aa,Oa,Ia,Rl=D(()=>{an(),Gt=(n,o)=>{if(n===void 0)throw new Error("Image buffer must be defined");if(o.height===void 0||o.width===void 0)throw new Error("Image height and width must be defined");if(o.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:l,width:i}=o,u=o.norm??{mean:255,bias:0},p,c;typeof u.mean=="number"?p=[u.mean,u.mean,u.mean,u.mean]:p=[u.mean[0],u.mean[1],u.mean[2],u.mean[3]??255],typeof u.bias=="number"?c=[u.bias,u.bias,u.bias,u.bias]:c=[u.bias[0],u.bias[1],u.bias[2],u.bias[3]??0];let d=o.format!==void 0?o.format:"RGBA",y=o.tensorFormat!==void 0&&o.tensorFormat!==void 0?o.tensorFormat:"RGB",b=l*i,v=y==="RGBA"?new Float32Array(b*4):new Float32Array(b*3),C=4,_=0,O=1,R=2,$=3,j=0,M=b,U=b*2,N=-1;d==="RGB"&&(C=3,_=0,O=1,R=2,$=-1),y==="RGBA"?N=b*3:y==="RBG"?(j=0,U=b,M=b*2):y==="BGR"&&(U=0,M=b,j=b*2);for(let L=0;L<b;L++,_+=C,R+=C,O+=C,$+=C)v[j++]=(n[_]+c[0])/p[0],v[M++]=(n[O]+c[1])/p[1],v[U++]=(n[R]+c[2])/p[2],N!==-1&&$!==-1&&(v[N++]=(n[$]+c[3])/p[3]);return y==="RGBA"?new me("float32",v,[1,4,l,i]):new me("float32",v,[1,3,l,i])},Ea=async(n,o)=>{let l=typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement,i=typeof ImageData<"u"&&n instanceof ImageData,u=typeof ImageBitmap<"u"&&n instanceof ImageBitmap,p=typeof n=="string",c,d=o??{},y=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},b=v=>typeof HTMLCanvasElement<"u"&&v instanceof HTMLCanvasElement||v instanceof OffscreenCanvas?v.getContext("2d"):null;if(l){let v=y();v.width=n.width,v.height=n.height;let C=b(v);if(C!=null){let _=n.height,O=n.width;if(o!==void 0&&o.resizedHeight!==void 0&&o.resizedWidth!==void 0&&(_=o.resizedHeight,O=o.resizedWidth),o!==void 0){if(d=o,o.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");d.tensorFormat="RGBA",d.height=_,d.width=O}else d.tensorFormat="RGBA",d.height=_,d.width=O;C.drawImage(n,0,0),c=C.getImageData(0,0,O,_).data}else throw new Error("Can not access image data")}else if(i){let v,C;if(o!==void 0&&o.resizedWidth!==void 0&&o.resizedHeight!==void 0?(v=o.resizedHeight,C=o.resizedWidth):(v=n.height,C=n.width),o!==void 0&&(d=o),d.format="RGBA",d.height=v,d.width=C,o!==void 0){let _=y();_.width=C,_.height=v;let O=b(_);if(O!=null)O.putImageData(n,0,0),c=O.getImageData(0,0,C,v).data;else throw new Error("Can not access image data")}else c=n.data}else if(u){if(o===void 0)throw new Error("Please provide image config with format for Imagebitmap");let v=y();v.width=n.width,v.height=n.height;let C=b(v);if(C!=null){let _=n.height,O=n.width;return C.drawImage(n,0,0,O,_),c=C.getImageData(0,0,O,_).data,d.height=_,d.width=O,Gt(c,d)}else throw new Error("Can not access image data")}else{if(p)return new Promise((v,C)=>{let _=y(),O=b(_);if(!n||!O)return C();let R=new Image;R.crossOrigin="Anonymous",R.src=n,R.onload=()=>{_.width=R.width,_.height=R.height,O.drawImage(R,0,0,_.width,_.height);let $=O.getImageData(0,0,_.width,_.height);d.height=_.height,d.width=_.width,v(Gt($.data,d))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(c!==void 0)return Gt(c,d);throw new Error("Input data provided is not supported - aborted tensor creation")},xa=(n,o)=>{let{width:l,height:i,download:u,dispose:p}=o,c=[1,i,l,4];return new me({location:"texture",type:"float32",texture:n,dims:c,download:u,dispose:p})},Aa=(n,o)=>{let{dataType:l,dims:i,download:u,dispose:p}=o;return new me({location:"gpu-buffer",type:l??"float32",gpuBuffer:n,dims:i,download:u,dispose:p})},Oa=(n,o)=>{let{dataType:l,dims:i,download:u,dispose:p}=o;return new me({location:"ml-tensor",type:l??"float32",mlTensor:n,dims:i,download:u,dispose:p})},Ia=(n,o,l)=>new me({location:"cpu-pinned",type:n,data:o,dims:l??[o.length]})}),Je,It,Ur,Sa,Ml=D(()=>{Je=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),It=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),Ur=!1,Sa=()=>{if(!Ur){Ur=!0;let n=typeof BigInt64Array<"u"&&BigInt64Array.from,o=typeof BigUint64Array<"u"&&BigUint64Array.from,l=globalThis.Float16Array,i=typeof l<"u"&&l.from;n&&(Je.set("int64",BigInt64Array),It.set(BigInt64Array,"int64")),o&&(Je.set("uint64",BigUint64Array),It.set(BigUint64Array,"uint64")),i?(Je.set("float16",l),It.set(l,"float16")):Je.set("float16",Uint16Array)}}}),Ua,Ba,Ll=D(()=>{an(),Ua=n=>{let o=1;for(let l=0;l<n.length;l++){let i=n[l];if(typeof i!="number"||!Number.isSafeInteger(i))throw new TypeError(`dims[${l}] must be an integer, got: ${i}`);if(i<0)throw new RangeError(`dims[${l}] must be a non-negative integer, got: ${i}`);o*=i}return o},Ba=(n,o)=>{switch(n.location){case"cpu":return new me(n.type,n.data,o);case"cpu-pinned":return new me({location:"cpu-pinned",data:n.data,type:n.type,dims:o});case"texture":return new me({location:"texture",texture:n.texture,type:n.type,dims:o});case"gpu-buffer":return new me({location:"gpu-buffer",gpuBuffer:n.gpuBuffer,type:n.type,dims:o});case"ml-tensor":return new me({location:"ml-tensor",mlTensor:n.mlTensor,type:n.type,dims:o});default:throw new Error(`tensorReshape: tensor location ${n.location} is not supported`)}}}),me,an=D(()=>{Bl(),Rl(),Ml(),Ll(),me=class{constructor(n,o,l){Sa();let i,u;if(typeof n=="object"&&"location"in n)switch(this.dataLocation=n.location,i=n.type,u=n.dims,n.location){case"cpu-pinned":{let c=Je.get(i);if(!c)throw new TypeError(`unsupported type "${i}" to create tensor from pinned buffer`);if(!(n.data instanceof c))throw new TypeError(`buffer should be of type ${c.name}`);this.cpuData=n.data;break}case"texture":{if(i!=="float32")throw new TypeError(`unsupported type "${i}" to create tensor from texture`);this.gpuTextureData=n.texture,this.downloader=n.download,this.disposer=n.dispose;break}case"gpu-buffer":{if(i!=="float32"&&i!=="float16"&&i!=="int32"&&i!=="int64"&&i!=="uint32"&&i!=="uint8"&&i!=="bool"&&i!=="uint4"&&i!=="int4")throw new TypeError(`unsupported type "${i}" to create tensor from gpu buffer`);this.gpuBufferData=n.gpuBuffer,this.downloader=n.download,this.disposer=n.dispose;break}case"ml-tensor":{if(i!=="float32"&&i!=="float16"&&i!=="int32"&&i!=="int64"&&i!=="uint32"&&i!=="uint64"&&i!=="int8"&&i!=="uint8"&&i!=="bool"&&i!=="uint4"&&i!=="int4")throw new TypeError(`unsupported type "${i}" to create tensor from MLTensor`);this.mlTensorData=n.mlTensor,this.downloader=n.download,this.disposer=n.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let c,d;if(typeof n=="string")if(i=n,d=l,n==="string"){if(!Array.isArray(o))throw new TypeError("A string tensor's data must be a string array.");c=o}else{let y=Je.get(n);if(y===void 0)throw new TypeError(`Unsupported tensor type: ${n}.`);if(Array.isArray(o)){if(n==="float16"&&y===Uint16Array||n==="uint4"||n==="int4")throw new TypeError(`Creating a ${n} tensor from number array is not supported. Please use ${y.name} as data.`);n==="uint64"||n==="int64"?c=y.from(o,BigInt):c=y.from(o)}else if(o instanceof y)c=o;else if(o instanceof Uint8ClampedArray)if(n==="uint8")c=Uint8Array.from(o);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(n==="float16"&&o instanceof Uint16Array&&y!==Uint16Array)c=new globalThis.Float16Array(o.buffer,o.byteOffset,o.length);else throw new TypeError(`A ${i} tensor's data must be type of ${y}`)}else if(d=o,Array.isArray(n)){if(n.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let y=typeof n[0];if(y==="string")i="string",c=n;else if(y==="boolean")i="bool",c=Uint8Array.from(n);else throw new TypeError(`Invalid element type of data array: ${y}.`)}else if(n instanceof Uint8ClampedArray)i="uint8",c=Uint8Array.from(n);else{let y=It.get(n.constructor);if(y===void 0)throw new TypeError(`Unsupported type for tensor data: ${n.constructor}.`);i=y,c=n}if(d===void 0)d=[c.length];else if(!Array.isArray(d))throw new TypeError("A tensor's dims must be a number array");u=d,this.cpuData=c,this.dataLocation="cpu"}let p=Ua(u);if(this.cpuData&&p!==this.cpuData.length&&!((i==="uint4"||i==="int4")&&Math.ceil(p/2)===this.cpuData.length))throw new Error(`Tensor's size(${p}) does not match data length(${this.cpuData.length}).`);this.type=i,this.dims=u,this.size=p}static async fromImage(n,o){return Ea(n,o)}static fromTexture(n,o){return xa(n,o)}static fromGpuBuffer(n,o){return Aa(n,o)}static fromMLTensor(n,o){return Oa(n,o)}static fromPinnedBuffer(n,o,l){return Ia(n,o,l)}toDataURL(n){return Ta(this,n)}toImageData(n){return _a(this,n)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(n){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let o=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=o,n&&this.disposer&&(this.disposer(),this.disposer=void 0),o}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(n){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return Ba(this,n)}}}),Be,Ra=D(()=>{an(),Be=me}),Jr,Br,pt,ct,Ke,et,Ma=D(()=>{Ca(),Jr=(n,o)=>{(typeof oe.trace>"u"?!oe.wasm.trace:!oe.trace)||console.timeStamp(`${n}::ORT::${o}`)},Br=(n,o)=>{let l=new Error().stack?.split(/\r\n|\r|\n/g)||[],i=!1;for(let u=0;u<l.length;u++){if(i&&!l[u].includes("TRACE_FUNC")){let p=`FUNC_${n}::${l[u].trim().split(" ")[1]}`;o&&(p+=`::${o}`),Jr("CPU",p);return}l[u].includes("TRACE_FUNC")&&(i=!0)}},pt=n=>{(typeof oe.trace>"u"?!oe.wasm.trace:!oe.trace)||Br("BEGIN",n)},ct=n=>{(typeof oe.trace>"u"?!oe.wasm.trace:!oe.trace)||Br("END",n)},Ke=n=>{(typeof oe.trace>"u"?!oe.wasm.trace:!oe.trace)||console.time(`ORT::${n}`)},et=n=>{(typeof oe.trace>"u"?!oe.wasm.trace:!oe.trace)||console.timeEnd(`ORT::${n}`)}}),La,jl=D(()=>{ba(),Ra(),Ma(),La=class ja{constructor(o){this.handler=o}async run(o,l,i){pt(),Ke("InferenceSession.run");let u={},p={};if(typeof o!="object"||o===null||o instanceof Be||Array.isArray(o))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let c=!0;if(typeof l=="object"){if(l===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(l instanceof Be)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(l)){if(l.length===0)throw new TypeError("'fetches' cannot be an empty array.");c=!1;for(let b of l){if(typeof b!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(b)===-1)throw new RangeError(`'fetches' contains invalid output name: ${b}.`);u[b]=null}if(typeof i=="object"&&i!==null)p=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else{let b=!1,v=Object.getOwnPropertyNames(l);for(let C of this.outputNames)if(v.indexOf(C)!==-1){let _=l[C];(_===null||_ instanceof Be)&&(b=!0,c=!1,u[C]=_)}if(b){if(typeof i=="object"&&i!==null)p=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else p=l}}else if(typeof l<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let b of this.inputNames)if(typeof o[b]>"u")throw new Error(`input '${b}' is missing in 'feeds'.`);if(c)for(let b of this.outputNames)u[b]=null;let d=await this.handler.run(o,u,p),y={};for(let b in d)if(Object.hasOwnProperty.call(d,b)){let v=d[b];v instanceof Be?y[b]=v:y[b]=new Be(v.type,v.data,v.dims)}return et("InferenceSession.run"),ct(),y}async release(){return this.handler.dispose()}static async create(o,l,i,u){pt(),Ke("InferenceSession.create");let p,c={};if(typeof o=="string"){if(p=o,typeof l=="object"&&l!==null)c=l;else if(typeof l<"u")throw new TypeError("'options' must be an object.")}else if(o instanceof Uint8Array){if(p=o,typeof l=="object"&&l!==null)c=l;else if(typeof l<"u")throw new TypeError("'options' must be an object.")}else if(o instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&o instanceof SharedArrayBuffer){let v=o,C=0,_=o.byteLength;if(typeof l=="object"&&l!==null)c=l;else if(typeof l=="number"){if(C=l,!Number.isSafeInteger(C))throw new RangeError("'byteOffset' must be an integer.");if(C<0||C>=v.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${v.byteLength}).`);if(_=o.byteLength-C,typeof i=="number"){if(_=i,!Number.isSafeInteger(_))throw new RangeError("'byteLength' must be an integer.");if(_<=0||C+_>v.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${v.byteLength-C}].`);if(typeof u=="object"&&u!==null)c=u;else if(typeof u<"u")throw new TypeError("'options' must be an object.")}else if(typeof i<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof l<"u")throw new TypeError("'options' must be an object.");p=new Uint8Array(v,C,_)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[d,y]=await wa(c),b=await d.createInferenceSessionHandler(p,y);return et("InferenceSession.create"),ct(),new ja(b)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),Pa,Pl=D(()=>{jl(),Pa=La}),$l=D(()=>{}),kl=D(()=>{}),Dl=D(()=>{}),Nl=D(()=>{}),$a={};Ut($a,{InferenceSession:()=>Pa,TRACE:()=>Jr,TRACE_EVENT_BEGIN:()=>Ke,TRACE_EVENT_END:()=>et,TRACE_FUNC_BEGIN:()=>pt,TRACE_FUNC_END:()=>ct,Tensor:()=>Be,env:()=>Z,registerBackend:()=>dt});var tt=D(()=>{Il(),Ul(),Pl(),Ra(),$l(),kl(),Ma(),Dl(),Nl()}),on=D(()=>{}),ka={};Ut(ka,{default:()=>Da});var Rr,Mr,Da,Wl=D(()=>{eo(),rt(),sn(),Rr="ort-wasm-proxy-worker",Mr=globalThis.self?.name===Rr,Mr&&(self.onmessage=n=>{let{type:o,in:l}=n.data;try{switch(o){case"init-wasm":ln(l.wasm).then(()=>{cn(l).then(()=>{postMessage({type:o})},i=>{postMessage({type:o,err:i})})},i=>{postMessage({type:o,err:i})});break;case"init-ep":{let{epName:i,env:u}=l;hn(u,i).then(()=>{postMessage({type:o})},p=>{postMessage({type:o,err:p})});break}case"copy-from":{let{buffer:i}=l,u=Kt(i);postMessage({type:o,out:u});break}case"create":{let{model:i,options:u}=l;yn(i,u).then(p=>{postMessage({type:o,out:p})},p=>{postMessage({type:o,err:p})});break}case"release":mn(l),postMessage({type:o});break;case"run":{let{sessionId:i,inputIndices:u,inputs:p,outputIndices:c,options:d}=l;gn(i,u,p,c,new Array(c.length).fill(null),d).then(y=>{y.some(b=>b[3]!=="cpu")?postMessage({type:o,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:o,out:y},bn([...p,...y]))},y=>{postMessage({type:o,err:y})});break}case"end-profiling":wn(l),postMessage({type:o});break;default:}}catch(i){postMessage({type:o,err:i})}}),Da=Mr?null:n=>new Worker(n??he,{type:"module",name:Rr})}),Na={};Ut(Na,{default:()=>Wa});var Lr,Wa,qi,Gl=D(()=>{Lr=async function(n={}){var o,l,i=n,u=new Promise((e,t)=>{o=e,l=t}),p=typeof window=="object",c=typeof WorkerGlobalScope<"u",d=c&&self.name?.startsWith("em-pthread");i.mountExternalData=(e,t)=>{e.startsWith("./")&&(e=e.substring(2)),(i.fc||(i.fc=new Map)).set(e,t)},i.unmountExternalData=()=>{delete i.fc};var y=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,ld:!0}).buffer.constructor;let b=()=>{let e=(t,r,a)=>(...s)=>{let f=Se,h=r?.();s=t(...s);let m=r?.();return h!==m&&(t=m,a(h),r=a=null),Se!=f?new Promise((w,T)=>{pr={resolve:w,reject:T}}):s};(()=>{for(let t of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])i[t]=e(i[t],()=>i[t],r=>i[t]=r)})(),typeof jsepRunAsync<"u"&&(i._OrtRun=jsepRunAsync(i._OrtRun),i._OrtRunWithBinding=jsepRunAsync(i._OrtRunWithBinding)),b=void 0};i.asyncInit=()=>{b?.()};var v,C,_=(e,t)=>{throw t},O=import.meta.url,R="";if(p||c){try{R=new URL(".",O).href}catch{}c&&(C=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),v=async e=>{if(K(e))return new Promise((r,a)=>{var s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onload=()=>{s.status==200||s.status==0&&s.response?r(s.response):a(s.status)},s.onerror=a,s.send(null)});var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw Error(t.status+" : "+t.url)}}var $,j,M,U,N,L,F,ne,se,ee,te,ie,X,ge,yt,P=console.log.bind(console),we=console.error.bind(console),nt=P,k=we,ae=!1,K=e=>e.startsWith("file://");function re(){return j.buffer!=N.buffer&&W(),N}function Y(){return j.buffer!=N.buffer&&W(),L}function xe(){return j.buffer!=N.buffer&&W(),F}function it(){return j.buffer!=N.buffer&&W(),ne}function I(){return j.buffer!=N.buffer&&W(),se}function x(){return j.buffer!=N.buffer&&W(),ee}function be(){return j.buffer!=N.buffer&&W(),te}function pe(){return j.buffer!=N.buffer&&W(),ge}if(d){let e=function(t){try{var r=t.data,a=r.dc;if(a==="load"){let s=[];self.onmessage=f=>s.push(f),self.startWorker=()=>{postMessage({dc:"loaded"});for(let f of s)e(f);self.onmessage=e};for(let f of r.Uc)i[f]&&!i[f].proxy||(i[f]=(...h)=>{postMessage({dc:"callHandler",Tc:f,args:h})},f=="print"&&(nt=i[f]),f=="printErr"&&(k=i[f]));j=r.bd,W(),yt(r.cd)}else if(a==="run"){co(r.ac),xr(r.ac,0,0,1,0,0),On(),fr(r.ac),J||(Ci(),J=!0);try{ho(r.Zc,r.jc)}catch(s){if(s!="unwind")throw s}}else r.target!=="setimmediate"&&(a==="checkMailbox"?J&&Bt():a&&(k(`worker: received unknown command ${a}`),k(r)))}catch(s){throw ji(),s}};var J=!1;self.onunhandledrejection=t=>{throw t.reason||t},self.onmessage=e}function W(){var e=j.buffer;i.HEAP8=N=new Int8Array(e),F=new Int16Array(e),i.HEAPU8=L=new Uint8Array(e),ne=new Uint16Array(e),i.HEAP32=se=new Int32Array(e),i.HEAPU32=ee=new Uint32Array(e),te=new Float32Array(e),ge=new Float64Array(e),ie=new BigInt64Array(e),X=new BigUint64Array(e)}function ve(){d?startWorker(i):g.nb()}var He,Re=0,mt=null;function vn(){if(--Re==0&&mt){var e=mt;mt=null,e()}}function Me(e){throw k(e="Aborted("+e+")"),ae=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),l(e),e}function Cn(){return{a:{R:Cl,b:mo,ba:Bn,I:Ln,ra:jn,jb:Pn,lb:$n,sa:kn,pa:Dn,ia:Nn,oa:Wn,P:Gn,kb:Fn,hb:Vn,qa:zn,ib:Hn,xa:go,Z:wo,cb:bo,ab:Co,Y:_o,w:Eo,t:xo,bb:Ao,L:Mo,db:Lo,la:jo,fb:Po,ca:$o,_a:ko,$:Do,ka:fr,ua:No,s:Wo,Na:Go,A:zo,o:Ho,m:Zo,c:sr,Ma:Xo,n:Yo,i:Ko,v:es,p:ts,f:rs,u:ns,k:is,e:as,j:os,h:ss,g:ls,d:us,fa:fs,ga:ds,ha:ps,da:ai,ea:oi,$a:si,za:hs,wa:ms,E:gs,La:ws,M:bs,va:ys,C:vs,ta:Cs,gb:Ts,r:cs,Ia:_s,F:Es,Q:xs,eb:As,Ba:Os,Aa:Is,Ha:js,q:Ps,U:$s,T:ks,Ka:Ds,D:Ns,l:Ws,Ga:Gs,Fa:Fs,Ja:Vs,Ea:zs,Da:Hs,Ca:qs,ma:ci,na:hi,aa:nr,J:yi,O:mi,ja:gi,N:wi,a:j,ya:rr,Xa:Xs,K:Ys,x:Js,S:Qs,Ya:Ks,y:el,Ta:tl,Va:rl,V:nl,z:il,_:al,W:ol,G:sl,Ra:ll,mb:ul,B:fl,Ua:dl,Wa:pl,Oa:cl,Pa:hl,Qa:yl,H:ml,X:gl,Sa:wl,Za:bl}}}class er{name="ExitStatus";constructor(t){this.message=`Program terminated with exit(${t})`,this.status=t}}var Tn=e=>{e.terminate(),e.onmessage=()=>{}},tr=[],_n=e=>{Ne.length==0&&(Sn(),In(Ne[0]));var t=Ne.pop();if(!t)return 6;gt.push(t),qe[e.ac]=t,t.ac=e.ac;var r={dc:"run",Zc:e.Yc,jc:e.jc,ac:e.ac};return t.postMessage(r,e.Oc),0},Q=0,q=(e,t,...r)=>{for(var a=2*r.length,s=_e(),f=Wt(8*a),h=f>>>3,m=0;m<r.length;m++){var w=r[m];typeof w=="bigint"?(ie[h+2*m]=1n,ie[h+2*m+1]=w):(ie[h+2*m]=0n,pe()[h+2*m+1>>>0]=w)}return e=Pi(e,0,a,f,t),Te(s),e};function rr(e){if(d)return q(0,1,e);if(U=e,!(0<Q)){for(var t of gt)Tn(t);for(t of Ne)Tn(t);Ne=[],gt=[],qe={},ae=!0}_(0,new er(e))}function En(e){if(d)return q(1,0,e);nr(e)}var nr=e=>{if(U=e,d)throw En(e),"unwind";rr(e)},Ne=[],gt=[],xn=[],qe={},An=e=>{var t=e.ac;delete qe[t],Ne.push(e),gt.splice(gt.indexOf(e),1),e.ac=0,$i(t)};function On(){xn.forEach(e=>e())}var In=e=>new Promise(t=>{e.onmessage=s=>{var f=(s=s.data).dc;if(s.hc&&s.hc!=vr()){var h=qe[s.hc];h?h.postMessage(s,s.Oc):k(`Internal error! Worker sent a message "${f}" to target pthread ${s.hc}, but that thread no longer exists!`)}else f==="checkMailbox"?Bt():f==="spawnThread"?_n(s):f==="cleanupThread"?An(qe[s.$c]):f==="loaded"?(e.loaded=!0,t(e)):s.target==="setimmediate"?e.postMessage(s):f==="callHandler"?i[s.Tc](...s.args):f&&k(`worker sent an unknown command ${f}`)},e.onerror=s=>{throw k(`worker sent an error! ${s.filename}:${s.lineno}: ${s.message}`),s};var r,a=[];for(r of[])i.propertyIsEnumerable(r)&&a.push(r);e.postMessage({dc:"load",Uc:a,bd:j,cd:M})});function Sn(){var e=new Worker((()=>{let t=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new t("ort.webgpu.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});Ne.push(e)}var co=e=>{W();var t=x()[e+52>>>2>>>0];e=x()[e+56>>>2>>>0],Ni(t,t-e),Te(t)},ho=(e,t)=>{Q=0,e=Wi(e,t),0<Q?U=e:Ar(e)};class yo{constructor(t){this.ic=t-24}}var ce=e=>-9007199254740992>e||9007199254740992<e?NaN:Number(e);function mo(e,t,r){var a=new yo(e>>>=0);throw t>>>=0,r>>>=0,x()[a.ic+16>>>2>>>0]=0,x()[a.ic+4>>>2>>>0]=t,x()[a.ic+8>>>2>>>0]=r,e}function Un(e,t,r,a){return d?q(2,1,e,t,r,a):Bn(e,t,r,a)}function Bn(e,t,r,a){if(e>>>=0,r>>>=0,a>>>=0,y===void 0)return 6;var s=[];return d&&s.length===0?Un(e,t>>>=0,r,a):(e={Yc:r,ac:e,jc:a,Oc:s},d?(e.dc="spawnThread",postMessage(e,s),0):_n(e))}var Rn=typeof TextDecoder<"u"?new TextDecoder:void 0,Mn=(e,t=0,r=NaN)=>{var a=(t>>>=0)+r;for(r=t;e[r]&&!(r>=a);)++r;if(16<r-t&&e.buffer&&Rn)return Rn.decode(e.buffer instanceof ArrayBuffer?e.subarray(t,r):e.slice(t,r));for(a="";t<r;){var s=e[t++];if(128&s){var f=63&e[t++];if((224&s)==192)a+=String.fromCharCode((31&s)<<6|f);else{var h=63&e[t++];65536>(s=(240&s)==224?(15&s)<<12|f<<6|h:(7&s)<<18|f<<12|h<<6|63&e[t++])?a+=String.fromCharCode(s):(s-=65536,a+=String.fromCharCode(55296|s>>10,56320|1023&s))}}else a+=String.fromCharCode(s)}return a},at=(e,t)=>(e>>>=0)?Mn(Y(),e,t):"";function Ln(e,t,r){return d?q(3,1,e,t,r):0}function jn(e,t){if(d)return q(4,1,e,t)}function Pn(e,t){if(d)return q(5,1,e,t)}function $n(e,t,r){if(d)return q(6,1,e,t,r)}function kn(e,t,r){return d?q(7,1,e,t,r):0}function Dn(e,t){if(d)return q(8,1,e,t)}function Nn(e,t,r){if(d)return q(9,1,e,t,r)}function Wn(e,t,r,a){if(d)return q(10,1,e,t,r,a)}function Gn(e,t,r,a){if(d)return q(11,1,e,t,r,a)}function Fn(e,t,r,a){if(d)return q(12,1,e,t,r,a)}function Vn(e){if(d)return q(13,1,e)}function zn(e,t){if(d)return q(14,1,e,t)}function Hn(e,t,r){if(d)return q(15,1,e,t,r)}var qn,go=()=>Me(""),Ie=e=>{for(var t="";Y()[e>>>0];)t+=qn[Y()[e++>>>0]];return t},ir={},ar={},ot=i.BindingError=class extends Error{constructor(e){super(e),this.name="BindingError"}};function Le(e,t,r={}){return(function(a,s,f={}){var h=s.name;if(!a)throw new ot(`type "${h}" must have a positive integer typeid pointer`);if(ar.hasOwnProperty(a)){if(f.Vc)return;throw new ot(`Cannot register type '${h}' twice`)}ar[a]=s,ir.hasOwnProperty(a)&&(s=ir[a],delete ir[a],s.forEach(m=>m()))})(e,t,r)}var Zn=(e,t,r)=>{switch(t){case 1:return r?a=>re()[a>>>0]:a=>Y()[a>>>0];case 2:return r?a=>xe()[a>>>1>>>0]:a=>it()[a>>>1>>>0];case 4:return r?a=>I()[a>>>2>>>0]:a=>x()[a>>>2>>>0];case 8:return r?a=>ie[a>>>3]:a=>X[a>>>3];default:throw new TypeError(`invalid integer width (${t}): ${e}`)}};function wo(e,t,r){r>>>=0,Le(e>>>=0,{name:t=Ie(t>>>0),fromWireType:a=>a,toWireType:function(a,s){if(typeof s!="bigint"&&typeof s!="number")throw s=s===null?"null":(a=typeof s)=="object"||a==="array"||a==="function"?s.toString():""+s,new TypeError(`Cannot convert "${s}" to ${this.name}`);return typeof s=="number"&&(s=BigInt(s)),s},cc:We,readValueFromPointer:Zn(t,r,t.indexOf("u")==-1),ec:null})}var We=8;function bo(e,t,r,a){Le(e>>>=0,{name:t=Ie(t>>>0),fromWireType:function(s){return!!s},toWireType:function(s,f){return f?r:a},cc:We,readValueFromPointer:function(s){return this.fromWireType(Y()[s>>>0])},ec:null})}var or=[],je=[];function sr(e){9<(e>>>=0)&&--je[e+1]==0&&(je[e]=void 0,or.push(e))}var ue=e=>{if(!e)throw new ot(`Cannot use deleted val. handle = ${e}`);return je[e]},Ce=e=>{switch(e){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let t=or.pop()||je.length;return je[t]=e,je[t+1]=1,t}};function lr(e){return this.fromWireType(x()[e>>>2>>>0])}var vo={name:"emscripten::val",fromWireType:e=>{var t=ue(e);return sr(e),t},toWireType:(e,t)=>Ce(t),cc:We,readValueFromPointer:lr,ec:null};function Co(e){return Le(e>>>0,vo)}var To=(e,t)=>{switch(t){case 4:return function(r){return this.fromWireType(be()[r>>>2>>>0])};case 8:return function(r){return this.fromWireType(pe()[r>>>3>>>0])};default:throw new TypeError(`invalid float width (${t}): ${e}`)}};function _o(e,t,r){r>>>=0,Le(e>>>=0,{name:t=Ie(t>>>0),fromWireType:a=>a,toWireType:(a,s)=>s,cc:We,readValueFromPointer:To(t,r),ec:null})}function Eo(e,t,r,a,s){if(e>>>=0,r>>>=0,t=Ie(t>>>0),s===-1&&(s=4294967295),s=m=>m,a===0){var f=32-8*r;s=m=>m<<f>>>f}var h=t.includes("unsigned")?function(m,w){return w>>>0}:function(m,w){return w};Le(e,{name:t,fromWireType:s,toWireType:h,cc:We,readValueFromPointer:Zn(t,r,a!==0),ec:null})}function xo(e,t,r){function a(f){var h=x()[f>>>2>>>0];return f=x()[f+4>>>2>>>0],new s(re().buffer,f,h)}var s=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][t];Le(e>>>=0,{name:r=Ie(r>>>0),fromWireType:a,cc:We,readValueFromPointer:a},{Vc:!0})}var Pe=(e,t,r)=>{var a=Y();if(t>>>=0,0<r){var s=t;r=t+r-1;for(var f=0;f<e.length;++f){var h=e.charCodeAt(f);if(55296<=h&&57343>=h&&(h=65536+((1023&h)<<10)|1023&e.charCodeAt(++f)),127>=h){if(t>=r)break;a[t++>>>0]=h}else{if(2047>=h){if(t+1>=r)break;a[t++>>>0]=192|h>>6}else{if(65535>=h){if(t+2>=r)break;a[t++>>>0]=224|h>>12}else{if(t+3>=r)break;a[t++>>>0]=240|h>>18,a[t++>>>0]=128|h>>12&63}a[t++>>>0]=128|h>>6&63}a[t++>>>0]=128|63&h}}a[t>>>0]=0,e=t-s}else e=0;return e},$e=e=>{for(var t=0,r=0;r<e.length;++r){var a=e.charCodeAt(r);127>=a?t++:2047>=a?t+=2:55296<=a&&57343>=a?(t+=4,++r):t+=3}return t};function Ao(e,t){Le(e>>>=0,{name:t=Ie(t>>>0),fromWireType:function(r){for(var a,s=x()[r>>>2>>>0],f=r+4,h=f,m=0;m<=s;++m){var w=f+m;m!=s&&Y()[w>>>0]!=0||(h=at(h,w-h),a===void 0?a=h:(a+="\0",a+=h),h=w+1)}return Ae(r),a},toWireType:function(r,a){a instanceof ArrayBuffer&&(a=new Uint8Array(a));var s=typeof a=="string";if(!(s||ArrayBuffer.isView(a)&&a.BYTES_PER_ELEMENT==1))throw new ot("Cannot pass non-string to std::string");var f=s?$e(a):a.length,h=lt(4+f+1),m=h+4;return x()[h>>>2>>>0]=f,s?Pe(a,m,f+1):Y().set(a,m>>>0),r!==null&&r.push(Ae,h),h},cc:We,readValueFromPointer:lr,ec(r){Ae(r)}})}var Xn=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Oo=(e,t)=>{for(var r=e>>1,a=r+t/2;!(r>=a)&&it()[r>>>0];)++r;if(32<(r<<=1)-e&&Xn)return Xn.decode(Y().slice(e,r));for(r="",a=0;!(a>=t/2);++a){var s=xe()[e+2*a>>>1>>>0];if(s==0)break;r+=String.fromCharCode(s)}return r},Io=(e,t,r)=>{if(r??=2147483647,2>r)return 0;var a=t;r=(r-=2)<2*e.length?r/2:e.length;for(var s=0;s<r;++s){var f=e.charCodeAt(s);xe()[t>>>1>>>0]=f,t+=2}return xe()[t>>>1>>>0]=0,t-a},So=e=>2*e.length,Uo=(e,t)=>{for(var r=0,a="";!(r>=t/4);){var s=I()[e+4*r>>>2>>>0];if(s==0)break;++r,65536<=s?(s-=65536,a+=String.fromCharCode(55296|s>>10,56320|1023&s)):a+=String.fromCharCode(s)}return a},Bo=(e,t,r)=>{if(t>>>=0,r??=2147483647,4>r)return 0;var a=t;r=a+r-4;for(var s=0;s<e.length;++s){var f=e.charCodeAt(s);if(55296<=f&&57343>=f&&(f=65536+((1023&f)<<10)|1023&e.charCodeAt(++s)),I()[t>>>2>>>0]=f,(t+=4)+4>r)break}return I()[t>>>2>>>0]=0,t-a},Ro=e=>{for(var t=0,r=0;r<e.length;++r){var a=e.charCodeAt(r);55296<=a&&57343>=a&&++r,t+=4}return t};function Mo(e,t,r){if(e>>>=0,t>>>=0,r=Ie(r>>>=0),t===2)var a=Oo,s=Io,f=So,h=m=>it()[m>>>1>>>0];else t===4&&(a=Uo,s=Bo,f=Ro,h=m=>x()[m>>>2>>>0]);Le(e,{name:r,fromWireType:m=>{for(var w,T=x()[m>>>2>>>0],A=m+4,E=0;E<=T;++E){var B=m+4+E*t;E!=T&&h(B)!=0||(A=a(A,B-A),w===void 0?w=A:(w+="\0",w+=A),A=B+t)}return Ae(m),w},toWireType:(m,w)=>{if(typeof w!="string")throw new ot(`Cannot pass non-string to C++ string type ${r}`);var T=f(w),A=lt(4+T+t);return x()[A>>>2>>>0]=T/t,s(w,A+4,T+t),m!==null&&m.push(Ae,A),A},cc:We,readValueFromPointer:lr,ec(m){Ae(m)}})}function Lo(e,t){Le(e>>>=0,{Wc:!0,name:t=Ie(t>>>0),cc:0,fromWireType:()=>{},toWireType:()=>{}})}function jo(e){xr(e>>>0,!c,1,!p,131072,!1),On()}var ur=e=>{if(!ae)try{if(e(),!(0<Q))try{d?Ar(U):nr(U)}catch(t){t instanceof er||t=="unwind"||_(0,t)}}catch(t){t instanceof er||t=="unwind"||_(0,t)}};function fr(e){e>>>=0,typeof Atomics.ad=="function"&&(Atomics.ad(I(),e>>>2,e).value.then(Bt),e+=128,Atomics.store(I(),e>>>2,1))}var Bt=()=>{var e=vr();e&&(fr(e),ur(Di))};function Po(e,t){(e>>>=0)==t>>>0?setTimeout(Bt):d?postMessage({hc:e,dc:"checkMailbox"}):(e=qe[e])&&e.postMessage({dc:"checkMailbox"})}var dr=[];function $o(e,t,r,a,s){for(t>>>=0,a/=2,dr.length=a,r=s>>>0>>>3,s=0;s<a;s++)dr[s]=ie[r+2*s]?ie[r+2*s+1]:pe()[r+2*s+1>>>0];return(t?wr[t]:vl[e])(...dr)}var ko=()=>{Q=0};function Do(e){e>>>=0,d?postMessage({dc:"cleanupThread",$c:e}):An(qe[e])}function No(e){}var Rt=(e,t)=>{var r=ar[e];if(r===void 0)throw e=vi(e),r=Ie(e),Ae(e),new ot(`${t} has unknown type ${r}`);return r},Yn=(e,t,r)=>{var a=[];return e=e.toWireType(a,r),a.length&&(x()[t>>>2>>>0]=Ce(a)),e};function Wo(e,t,r){return t>>>=0,r>>>=0,e=ue(e>>>0),t=Rt(t,"emval::as"),Yn(t,r,e)}function Go(e,t){return t>>>=0,e=ue(e>>>0),(t=Rt(t,"emval::as")).toWireType(null,e)}var Mt=e=>{try{e()}catch(t){Me(t)}},Ge=0,Se=null,Jn=0,Lt=[],Qn={},Kn={},Fo=0,pr=null,Vo=[];function ei(e){return(function(t){if(!ae){if(Ge===0){var r=!1,a=!1;t((s=0)=>{if(!ae&&(Jn=s,r=!0,a)){Ge=2,Mt(()=>Vi(Se)),typeof MainLoop<"u"&&MainLoop.Sc&&MainLoop.resume(),s=!1;try{var f=(function(){var w=I()[Se+8>>>2>>>0];return w=g[Kn[w]],--Q,w()})()}catch(w){f=w,s=!0}var h=!1;if(!Se){var m=pr;m&&(pr=null,(s?m.reject:m.resolve)(f),h=!0)}if(s&&!h)throw f}}),a=!0,r||(Ge=1,Se=(function(){var s=lt(65548),f=s+12;x()[s>>>2>>>0]=f,x()[s+4>>>2>>>0]=f+65536,f=Lt[0];var h=Qn[f];return h===void 0&&(h=Fo++,Qn[f]=h,Kn[h]=f),f=h,I()[s+8>>>2>>>0]=f,s})(),typeof MainLoop<"u"&&MainLoop.Sc&&MainLoop.pause(),Mt(()=>Gi(Se)))}else Ge===2?(Ge=0,Mt(zi),Ae(Se),Se=null,Vo.forEach(ur)):Me(`invalid state: ${Ge}`);return Jn}})(t=>{e().then(t)})}function zo(e){return e>>>=0,ei(async()=>{var t=await ue(e);return Ce(t)})}var jt=[];function Ho(e,t,r,a){return r>>>=0,a>>>=0,(e=jt[e>>>0])(null,t=ue(t>>>0),r,a)}var qo={},Pt=e=>{var t=qo[e];return t===void 0?Ie(e):t};function Zo(e,t,r,a,s){return r>>>=0,a>>>=0,s>>>=0,(e=jt[e>>>0])(t=ue(t>>>0),t[r=Pt(r)],a,s)}function Xo(e,t){return t>>>=0,(e=ue(e>>>0))==ue(t)}var ti=()=>typeof globalThis=="object"?globalThis:Function("return this")();function Yo(e){return(e>>>=0)==0?Ce(ti()):(e=Pt(e),Ce(ti()[e]))}var Jo=e=>{var t=jt.length;return jt.push(e),t},Qo=(e,t)=>{for(var r=Array(e),a=0;a<e;++a)r[a]=Rt(x()[t+4*a>>>2>>>0],`parameter ${a}`);return r};function Ko(e,t,r){var a=(t=Qo(e,t>>>0)).shift();e--;var s=`return function (obj, func, destructorsRef, args) {
`,f=0,h=[];r===0&&h.push("obj");for(var m=["retType"],w=[a],T=0;T<e;++T)h.push(`arg${T}`),m.push(`argType${T}`),w.push(t[T]),s+=`  var arg${T} = argType${T}.readValueFromPointer(args${f?"+"+f:""});
`,f+=t[T].cc;return s+=`  var rv = ${r===1?"new func":"func.call"}(${h.join(", ")});
`,a.Wc||(m.push("emval_returnValue"),w.push(Yn),s+=`  return emval_returnValue(retType, destructorsRef, rv);
`),e=new Function(...m,s+`};
`)(...w),r=`methodCaller<(${t.map(A=>A.name).join(", ")}) => ${a.name}>`,Jo(Object.defineProperty(e,"name",{value:r}))}function es(e){return e=Pt(e>>>0),Ce(i[e])}function ts(e,t){return t>>>=0,e=ue(e>>>0),t=ue(t),Ce(e[t])}function rs(e){9<(e>>>=0)&&(je[e+1]+=1)}function ns(){return Ce([])}function is(e){e=ue(e>>>0);for(var t=Array(e.length),r=0;r<e.length;r++)t[r]=e[r];return Ce(t)}function as(e){return Ce(Pt(e>>>0))}function os(){return Ce({})}function ss(e){for(var t=ue(e>>>=0);t.length;){var r=t.pop();t.pop()(r)}sr(e)}function ls(e,t,r){t>>>=0,r>>>=0,e=ue(e>>>0),t=ue(t),r=ue(r),e[t]=r}function us(e,t){return t>>>=0,e=(e=Rt(e>>>0,"_emval_take_value")).readValueFromPointer(t),Ce(e)}function fs(e,t){e=ce(e),t>>>=0,e=new Date(1e3*e),I()[t>>>2>>>0]=e.getUTCSeconds(),I()[t+4>>>2>>>0]=e.getUTCMinutes(),I()[t+8>>>2>>>0]=e.getUTCHours(),I()[t+12>>>2>>>0]=e.getUTCDate(),I()[t+16>>>2>>>0]=e.getUTCMonth(),I()[t+20>>>2>>>0]=e.getUTCFullYear()-1900,I()[t+24>>>2>>>0]=e.getUTCDay(),e=(e.getTime()-Date.UTC(e.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,I()[t+28>>>2>>>0]=e}var ri=e=>e%4==0&&(e%100!=0||e%400==0),ni=[0,31,60,91,121,152,182,213,244,274,305,335],ii=[0,31,59,90,120,151,181,212,243,273,304,334];function ds(e,t){e=ce(e),t>>>=0,e=new Date(1e3*e),I()[t>>>2>>>0]=e.getSeconds(),I()[t+4>>>2>>>0]=e.getMinutes(),I()[t+8>>>2>>>0]=e.getHours(),I()[t+12>>>2>>>0]=e.getDate(),I()[t+16>>>2>>>0]=e.getMonth(),I()[t+20>>>2>>>0]=e.getFullYear()-1900,I()[t+24>>>2>>>0]=e.getDay();var r=(ri(e.getFullYear())?ni:ii)[e.getMonth()]+e.getDate()-1|0;I()[t+28>>>2>>>0]=r,I()[t+36>>>2>>>0]=-60*e.getTimezoneOffset(),r=new Date(e.getFullYear(),6,1).getTimezoneOffset();var a=new Date(e.getFullYear(),0,1).getTimezoneOffset();e=0|(r!=a&&e.getTimezoneOffset()==Math.min(a,r)),I()[t+32>>>2>>>0]=e}function ps(e){e>>>=0;var t=new Date(I()[e+20>>>2>>>0]+1900,I()[e+16>>>2>>>0],I()[e+12>>>2>>>0],I()[e+8>>>2>>>0],I()[e+4>>>2>>>0],I()[e>>>2>>>0],0),r=I()[e+32>>>2>>>0],a=t.getTimezoneOffset(),s=new Date(t.getFullYear(),6,1).getTimezoneOffset(),f=new Date(t.getFullYear(),0,1).getTimezoneOffset(),h=Math.min(f,s);return 0>r?I()[e+32>>>2>>>0]=+(s!=f&&h==a):0<r!=(h==a)&&(s=Math.max(f,s),t.setTime(t.getTime()+6e4*((0<r?h:s)-a))),I()[e+24>>>2>>>0]=t.getDay(),r=(ri(t.getFullYear())?ni:ii)[t.getMonth()]+t.getDate()-1|0,I()[e+28>>>2>>>0]=r,I()[e>>>2>>>0]=t.getSeconds(),I()[e+4>>>2>>>0]=t.getMinutes(),I()[e+8>>>2>>>0]=t.getHours(),I()[e+12>>>2>>>0]=t.getDate(),I()[e+16>>>2>>>0]=t.getMonth(),I()[e+20>>>2>>>0]=t.getYear(),e=t.getTime(),BigInt(isNaN(e)?-1:e/1e3)}function ai(e,t,r,a,s,f,h){return d?q(16,1,e,t,r,a,s,f,h):-52}function oi(e,t,r,a,s,f){if(d)return q(17,1,e,t,r,a,s,f)}var wt={},cs=()=>performance.timeOrigin+performance.now();function si(e,t){if(d)return q(18,1,e,t);if(wt[e]&&(clearTimeout(wt[e].id),delete wt[e]),!t)return 0;var r=setTimeout(()=>{delete wt[e],ur(()=>ki(e,performance.timeOrigin+performance.now()))},t);return wt[e]={id:r,nd:t},0}function hs(e,t,r,a){e>>>=0,t>>>=0,r>>>=0,a>>>=0;var s=new Date().getFullYear(),f=new Date(s,0,1).getTimezoneOffset();s=new Date(s,6,1).getTimezoneOffset();var h=Math.max(f,s);x()[e>>>2>>>0]=60*h,I()[t>>>2>>>0]=+(f!=s),e=(t=m=>{var w=Math.abs(m);return`UTC${0<=m?"-":"+"}${String(Math.floor(w/60)).padStart(2,"0")}${String(w%60).padStart(2,"0")}`})(f),t=t(s),s<f?(Pe(e,r,17),Pe(t,a,17)):(Pe(e,a,17),Pe(t,r,17))}var ys=()=>Date.now();function ms(e,t,r){return 0<=e&&3>=e?(e===0?e=Date.now():e=performance.timeOrigin+performance.now(),ie[r>>>0>>>3]=BigInt(Math.round(1e6*e)),0):28}var cr=[],li=(e,t)=>{cr.length=0;for(var r;r=Y()[e++>>>0];){var a=r!=105;t+=(a&=r!=112)&&t%8?4:0,cr.push(r==112?x()[t>>>2>>>0]:r==106?ie[t>>>3]:r==105?I()[t>>>2>>>0]:pe()[t>>>3>>>0]),t+=a?8:4}return cr};function gs(e,t,r){return e>>>=0,t=li(t>>>0,r>>>0),wr[e](...t)}function ws(e,t,r){return e>>>=0,t=li(t>>>0,r>>>0),wr[e](...t)}var bs=()=>{};function vs(e,t){return k(at(e>>>0,t>>>0))}var Cs=()=>{throw Q+=1,"unwind"};function Ts(){return 4294901760}var _s=()=>1,Es=()=>navigator.hardwareConcurrency;function xs(){return Me("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function As(e){e>>>=0;var t=Y().length;if(e<=t||4294901760<e)return!1;for(var r=1;4>=r;r*=2){var a=t*(1+.2/r);a=Math.min(a,e+100663296);e:{a=(Math.min(4294901760,65536*Math.ceil(Math.max(e,a)/65536))-j.buffer.byteLength+65535)/65536|0;try{j.grow(a),W();var s=1;break e}catch{}s=void 0}if(s)return!0}return!1}var $t=()=>(Me("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),bt={},ui=e=>{e.forEach(t=>{$t()})};function Os(){var e=Error().stack.toString().split(`
`);return e[0]=="Error"&&e.shift(),ui(e),bt.oc=$t(),bt.Xc=e,bt.oc}function Is(e,t,r){if(e>>>=0,t>>>=0,bt.oc==e)var a=bt.Xc;else(a=Error().stack.toString().split(`
`))[0]=="Error"&&a.shift(),ui(a);for(var s=3;a[s]&&$t()!=e;)++s;for(e=0;e<r&&a[e+s];++e)I()[t+4*e>>>2>>>0]=$t();return e}var ke=e=>{var t=$e(e)+1,r=Wt(t);return Pe(e,r,t),r},hr=[],fe=(e,t)=>{hr[e>>>=0]=t},Ue=[],kt=[],vt=(e,t)=>{kt[e]=new Promise(r=>t.finally(()=>r(e)))},S=e=>{if(e)return hr[e>>>0]},Dt=(e,t,r)=>{x()[e>>>2>>>0]=t,x()[e+4>>>2>>>0]=r},fi=e=>{var t=x()[e>>>2>>>0];return e=x()[e+4>>>2>>>0],at(t,e)},De=e=>{var t=x()[e>>>2>>>0];return e=x()[e+4>>>2>>>0],t?at(t,e):e===0?"":void 0},di=(e,t)=>{function r(s,f){s=e[s],I()[t+f>>>2>>>0]=s}function a(s,f){ie[t+f>>>3]=BigInt(e[s])}r("maxTextureDimension1D",4),r("maxTextureDimension2D",8),r("maxTextureDimension3D",12),r("maxTextureArrayLayers",16),r("maxBindGroups",20),r("maxBindGroupsPlusVertexBuffers",24),r("maxBindingsPerBindGroup",28),r("maxDynamicUniformBuffersPerPipelineLayout",32),r("maxDynamicStorageBuffersPerPipelineLayout",36),r("maxSampledTexturesPerShaderStage",40),r("maxSamplersPerShaderStage",44),r("maxStorageBuffersPerShaderStage",48),r("maxStorageTexturesPerShaderStage",52),r("maxUniformBuffersPerShaderStage",56),r("minUniformBufferOffsetAlignment",80),r("minStorageBufferOffsetAlignment",84),a("maxUniformBufferBindingSize",64),a("maxStorageBufferBindingSize",72),r("maxVertexBuffers",88),a("maxBufferSize",96),r("maxVertexAttributes",104),r("maxVertexBufferArrayStride",108),r("maxInterStageShaderVariables",112),r("maxColorAttachments",116),r("maxColorAttachmentBytesPerSample",120),r("maxComputeWorkgroupStorageSize",124),r("maxComputeInvocationsPerWorkgroup",128),r("maxComputeWorkgroupSizeX",132),r("maxComputeWorkgroupSizeY",136),r("maxComputeWorkgroupSizeZ",140),r("maxComputeWorkgroupsPerDimension",144),e.kd!==void 0&&r("maxImmediateSize",148)},Ss={undefined:1,pd:1,gd:2},Us={1:"validation",2:"out-of-memory",3:"internal"},Bs=[,"compatibility","core"],yr={1:"depth-clip-control",2:"depth32float-stencil8",3:"timestamp-query",4:"texture-compression-bc",5:"texture-compression-bc-sliced-3d",6:"texture-compression-etc2",7:"texture-compression-astc",8:"texture-compression-astc-sliced-3d",9:"indirect-first-instance",10:"shader-f16",11:"rg11b10ufloat-renderable",12:"bgra8unorm-storage",13:"float32-filterable",14:"float32-blendable",15:"clip-distances",16:"dual-source-blending",17:"subgroups",18:"core-features-and-limits",327692:"chromium-experimental-unorm16-texture-formats",327693:"chromium-experimental-snorm16-texture-formats",327732:"chromium-experimental-multi-draw-indirect"},Rs=[,"low-power","high-performance"],Ms={1:"occlusion",2:"timestamp"},Ls={"depth-clip-control":"1","depth32float-stencil8":"2","timestamp-query":"3","texture-compression-bc":"4","texture-compression-bc-sliced-3d":"5","texture-compression-etc2":"6","texture-compression-astc":"7","texture-compression-astc-sliced-3d":"8","indirect-first-instance":"9","shader-f16":"10","rg11b10ufloat-renderable":"11","bgra8unorm-storage":"12","float32-filterable":"13","float32-blendable":"14","clip-distances":"15","dual-source-blending":"16",md:"17","core-features-and-limits":"18","chromium-experimental-unorm16-texture-formats":"327692","chromium-experimental-snorm16-texture-formats":"327693","chromium-experimental-multi-draw-indirect":"327732"};function js(e,t,r,a,s,f){t=ce(t),r=ce(r),a>>>=0,s>>>=0,f>>>=0,e=S(e>>>0);var h={};if(f){var m=x()[f+12>>>2>>>0];if(m){var w=x()[f+16>>>2>>>0];h.requiredFeatures=Array.from(x().subarray(w>>>2>>>0,w+4*m>>>2>>>0),E=>yr[E])}var T=x()[f+20>>>2>>>0];if(T){let E=function(G,V,de=!1){V=T+V,(V=x()[V>>>2>>>0])==4294967295||de&&V==0||(A[G]=V)},B=function(G,V){V=T+V;var de=x()[V>>>2>>>0],Oe=x()[V+4>>>2>>>0];de==4294967295&&Oe==4294967295||(A[G]=4294967296*x()[V+4>>>2>>>0]+x()[V>>>2>>>0])};var A={};E("maxTextureDimension1D",4),E("maxTextureDimension2D",8),E("maxTextureDimension3D",12),E("maxTextureArrayLayers",16),E("maxBindGroups",20),E("maxBindGroupsPlusVertexBuffers",24),E("maxDynamicUniformBuffersPerPipelineLayout",32),E("maxDynamicStorageBuffersPerPipelineLayout",36),E("maxSampledTexturesPerShaderStage",40),E("maxSamplersPerShaderStage",44),E("maxStorageBuffersPerShaderStage",48),E("maxStorageTexturesPerShaderStage",52),E("maxUniformBuffersPerShaderStage",56),E("minUniformBufferOffsetAlignment",80),E("minStorageBufferOffsetAlignment",84),B("maxUniformBufferBindingSize",64),B("maxStorageBufferBindingSize",72),E("maxVertexBuffers",88),B("maxBufferSize",96),E("maxVertexAttributes",104),E("maxVertexBufferArrayStride",108),E("maxInterStageShaderVariables",112),E("maxColorAttachments",116),E("maxColorAttachmentBytesPerSample",120),E("maxComputeWorkgroupStorageSize",124),E("maxComputeInvocationsPerWorkgroup",128),E("maxComputeWorkgroupSizeX",132),E("maxComputeWorkgroupSizeY",136),E("maxComputeWorkgroupSizeZ",140),E("maxComputeWorkgroupsPerDimension",144),E("maxImmediateSize",148,!0),h.requiredLimits=A}(m=x()[f+24>>>2>>>0])&&(m={label:De(m+4)},h.defaultQueue=m),h.label=De(f+4)}Q+=1,vt(t,e.requestDevice(h).then(E=>{--Q,fe(s,E.queue),fe(a,E),r&&(Q+=1,vt(r,E.lost.then(B=>{--Q,E.onuncapturederror=()=>{};var G=_e(),V=ke(B.message);Cr(r,Ss[B.reason],V),Te(G)}))),E.onuncapturederror=B=>{var G=5;B.error instanceof GPUValidationError?G=2:B.error instanceof GPUOutOfMemoryError?G=3:B.error instanceof GPUInternalError&&(G=4);var V=_e();B=ke(B.error.message),Li(a,G,B),Te(V)},Er(t,1,a,0)},E=>{--Q;var B=_e();E=ke(E.message),Er(t,3,a,E),r&&Cr(r,4,E),Te(B)}))}function Ps(e){var t=S(e>>>=0),r=Ue[e];if(r){for(var a=0;a<r.length;++a)r[a]();delete Ue[e]}t.destroy()}var st=()=>{var e="getMappedRange size=0 no longer means WGPU_WHOLE_MAP_SIZE";st.kc||(st.kc={}),st.kc[e]||(st.kc[e]=1,k(e))};function $s(e,t,r){t>>>=0,r>>>=0;var a=S(e>>>=0);r===0&&st(),r==4294967295&&(r=void 0);try{var s=a.getMappedRange(t,r)}catch{return 0}var f=Or(16,s.byteLength);return Y().set(new Uint8Array(s),f>>>0),Ue[e].push(()=>Ae(f)),f}function ks(e,t,r){t>>>=0,r>>>=0;var a=S(e>>>=0);r===0&&st(),r==4294967295&&(r=void 0);try{var s=a.getMappedRange(t,r)}catch{return 0}var f=Or(16,s.byteLength);return Y().fill(0,f,s.byteLength),Ue[e].push(()=>{new Uint8Array(s).set(Y().subarray(f>>>0,f+s.byteLength>>>0)),Ae(f)}),f}function Ds(e,t,r,a,s){e>>>=0,t=ce(t),r=ce(r),s>>>=0;var f=S(e);Ue[e]=[],s==4294967295&&(s=void 0),Q+=1,vt(t,f.mapAsync(r,a>>>0,s).then(()=>{--Q,Tr(t,1,0)},h=>{--Q,_e();var m=ke(h.message);Tr(t,h.name==="AbortError"?4:h.name==="OperationError"?3:0,m),delete Ue[e]}))}function Ns(e){var t=S(e>>>=0),r=Ue[e];if(r){for(var a=0;a<r.length;++a)r[a]();delete Ue[e],t.unmap()}}function Ws(e){delete hr[e>>>0]}function Gs(e,t,r){e>>>=0,t>>>=0,r>>>=0;var a=!!x()[t+32>>>2>>>0];t={label:De(t+4),usage:x()[t+16>>>2>>>0],size:4294967296*x()[t+28>>>2>>>0]+x()[t+24>>>2>>>0],mappedAtCreation:a},e=S(e);try{var s=e.createBuffer(t)}catch{return!1}return fe(r,s),a&&(Ue[r]=[]),!0}function Fs(e,t,r){e>>>=0,t>>>=0,r>>>=0;var a=x()[t>>>2>>>0],s=x()[a+4>>>2>>>0];t={label:De(t+4),code:""},s===2&&(t.code=fi(a+8)),fe(r,S(e).createShaderModule(t))}var Vs=e=>{S(e).destroy()};function zs(e,t){t=ce(t),e=S(e>>>0),Q+=1,vt(t,e.popErrorScope().then(r=>{--Q;var a=5;r?r instanceof GPUValidationError?a=2:r instanceof GPUOutOfMemoryError?a=3:r instanceof GPUInternalError&&(a=4):a=1;var s=_e();r=r?ke(r.message):0,_r(t,1,a,r),Te(s)},r=>{--Q;var a=_e();r=ke(r.message),_r(t,1,5,r),Te(a)}))}function Hs(e,t,r,a){if(t=ce(t),a>>>=0,r>>>=0){var s=x()[r+4>>>2>>>0];s={featureLevel:Bs[s],powerPreference:Rs[x()[r+8>>>2>>>0]],forceFallbackAdapter:!!x()[r+12>>>2>>>0]},(r=x()[r>>>2>>>0])!==0&&(x(),s.rd=!!x()[r+8>>>2>>>0])}"gpu"in navigator?(Q+=1,vt(t,navigator.gpu.requestAdapter(s).then(f=>{if(--Q,f)fe(a,f),Ct(t,1,a,0);else{f=_e();var h=ke("WebGPU not available on this browser (requestAdapter returned null)");Ct(t,3,a,h),Te(f)}},f=>{--Q;var h=_e();f=ke(f.message),Ct(t,4,a,f),Te(h)}))):(r=_e(),s=ke("WebGPU not available on this browser (navigator.gpu is not available)"),Ct(t,3,a,s),Te(r))}function qs(e,t,r){return e>>>=0,t>>>=0,r>>>=0,ei(async()=>{var a=[];if(r){var s=I()[r>>>2>>>0];a.length=t+1,a[t]=new Promise(m=>setTimeout(m,s,0))}else a.length=t;for(var f=0;f<t;++f){var h=4294967296*x()[e+8*f+4>>>2>>>0]+x()[e+8*f>>>2>>>0];if(!(h in kt))return h;a[f]=kt[h]}return a=await Promise.race(a),delete kt[a],a})}var mr,gr={},pi=()=>{if(!mr){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(e in gr)gr[e]===void 0?delete t[e]:t[e]=gr[e];var r=[];for(e in t)r.push(`${e}=${t[e]}`);mr=r}return mr};function ci(e,t){if(d)return q(19,1,e,t);e>>>=0,t>>>=0;var r,a=0,s=0;for(r of pi()){var f=t+a;x()[e+s>>>2>>>0]=f,a+=Pe(r,f,1/0)+1,s+=4}return 0}function hi(e,t){if(d)return q(20,1,e,t);e>>>=0,t>>>=0;var r=pi();for(var a of(x()[e>>>2>>>0]=r.length,e=0,r))e+=$e(a)+1;return x()[t>>>2>>>0]=e,0}function yi(e){return d?q(21,1,e):52}function mi(e,t,r,a){return d?q(22,1,e,t,r,a):52}function gi(e,t,r,a){return d?q(23,1,e,t,r,a):70}var Zs=[null,[],[]];function wi(e,t,r,a){if(d)return q(24,1,e,t,r,a);t>>>=0,r>>>=0,a>>>=0;for(var s=0,f=0;f<r;f++){var h=x()[t>>>2>>>0],m=x()[t+4>>>2>>>0];t+=8;for(var w=0;w<m;w++){var T=e,A=Y()[h+w>>>0],E=Zs[T];A===0||A===10?((T===1?nt:k)(Mn(E)),E.length=0):E.push(A)}s+=m}return x()[a>>>2>>>0]=s,0}function Xs(e,t){return di(S(e>>>0).limits,t>>>0),1}function Ys(e,t){return S(e>>>0).features.has(yr[t])}function Js(e){return BigInt(S(e>>>0).size)}function Qs(e){return BigInt(S(e>>>0).usage)}function Ks(e,t){if(e>>>=0,t>>>=0){var r=De(t+4);r={label:r,timestampWrites:t=(t=x()[t+12>>>2>>>0])!==0?{querySet:S(x()[t+4>>>2>>>0]),beginningOfPassWriteIndex:x()[t+8>>>2>>>0],endOfPassWriteIndex:x()[t+12>>>2>>>0]}:void 0}}return e=S(e),t=Ii(0),fe(t,e.beginComputePass(r)),t}function el(e,t,r,a,s,f){r=ce(r),s=ce(s),f=ce(f),S(e>>>0).copyBufferToBuffer(S(t>>>0),r,S(a>>>0),s,f)}function tl(e){e=S(e>>>0);var t=Ai(0);return fe(t,e.finish()),t}function rl(e,t,r,a,s,f){f=ce(f),S(e>>>0).resolveQuerySet(S(t>>>0),r,a,S(s>>>0),f)}function nl(e,t,r,a){S(e>>>0).dispatchWorkgroups(t,r,a)}function il(e){S(e>>>0).end()}function al(e,t,r,a,s){a>>>=0,s>>>=0,e=S(e>>>0),r=S(r>>>0),a==0?e.setBindGroup(t,r):e.setBindGroup(t,r,x(),s>>>2,a)}function ol(e,t){S(e>>>0).setPipeline(S(t>>>0))}function sl(e,t,r){S(e>>>0).qd(S(t>>>0),r)}function ll(e,t){e=S(e>>>0);var r=xi(0);return fe(r,e.getBindGroupLayout(t)),r}function ul(e,t){e>>>=0;var r=De(4+(t>>>=0)),a=S(x()[t+12>>>2>>>0]),s=x()[t+16>>>2>>>0];t=x()[t+20>>>2>>>0];for(var f=[],h=0;h<s;++h){var m=f,w=m.push,T=t+40*h,A=x()[T+8>>>2>>>0],E=x()[T+32>>>2>>>0],B=x()[T+36>>>2>>>0],G=x()[T+4>>>2>>>0];A?(E=T+24,(E=x()[E>>>2>>>0]+4294967296*I()[E+4>>>2>>>0])==-1&&(E=void 0),T={binding:G,resource:{buffer:S(A),offset:4294967296*x()[T+4+16>>>2>>>0]+x()[T+16>>>2>>>0],size:E}}):T=E?{binding:G,resource:S(E)}:{binding:G,resource:S(B)},w.call(m,T)}return r={label:r,layout:a,entries:f},e=S(e),a=Ei(0),fe(a,e.createBindGroup(r)),a}function fl(e,t){var r;return e>>>=0,(t>>>=0)&&(r={label:De(t+4)}),e=S(e),t=Oi(0),fe(t,e.createCommandEncoder(r)),t}function dl(e,t){e>>>=0;var r=t>>>0;t=De(r+4);var a=(a=x()[r+12>>>2>>>0])?S(a):"auto";if(r+=16){var s=S(x()[r+4>>>2>>>0]),f=x()[r+16>>>2>>>0],h=x()[r+20>>>2>>>0];if(f){for(var m={},w=0;w<f;++w){var T=h+24*w;m[fi(T+4)]=pe()[T+16>>>3>>>0]}f=m}else f=void 0;r={module:s,constants:f,entryPoint:De(r+8)}}else r=void 0;return t={label:t,layout:a,compute:r},e=S(e),a=Si(0),fe(a,e.createComputePipeline(t)),a}function pl(e,t){e>>>=0,t>>>=0,t={type:Ms[x()[t+12>>>2>>>0]],count:x()[t+16>>>2>>>0]},e=S(e);var r=Ui(0);return fe(r,e.createQuerySet(t)),r}function cl(e,t){e=S(e>>>0).adapterInfo,t>>>=0,I()[t+52>>>2>>>0]=e.subgroupMinSize,I()[t+56>>>2>>>0]=e.subgroupMaxSize;var r=e.vendor+e.architecture+e.device+e.description,a=$e(r)+1,s=lt(a);return s&&Pe(r,s,a),r=s,a=$e(e.vendor),Dt(t+4,r,a),r+=a,a=$e(e.architecture),Dt(t+12,r,a),r+=a,a=$e(e.device),Dt(t+20,r,a),Dt(t+28,r+a,$e(e.description)),I()[t+36>>>2>>>0]=2,e=e.isFallbackAdapter?3:4,I()[t+40>>>2>>>0]=e,I()[t+44>>>2>>>0]=0,I()[t+48>>>2>>>0]=0,1}function hl(e,t){t>>>=0,e=S(e>>>0);var r=lt(4*e.features.size),a=0,s=0;e.features.forEach(f=>{(f=Ls[f])!==void 0&&(I()[r+a>>>2>>>0]=f,a+=4,s++)}),x()[t+4>>>2>>>0]=r,x()[t>>>2>>>0]=s}function yl(e,t){return di(S(e>>>0).limits,t>>>0),1}function ml(e,t){return S(e>>>0).features.has(yr[t])}function gl(e,t){S(e>>>0).pushErrorScope(Us[t])}function wl(e,t,r){t>>>=0,r>>>=0,e=S(e>>>0),t=Array.from(I().subarray(r>>>2>>>0,r+4*t>>>2>>>0),a=>S(a)),e.submit(t)}function bl(e,t,r,a,s){r=ce(r),a>>>=0,s>>>=0,e=S(e>>>0),t=S(t>>>0),a=Y().subarray(a>>>0,a+s>>>0),e.writeBuffer(t,r,a,0,s)}d||(function(){for(var e=i.numThreads-1;e--;)Sn();tr.push(()=>{Re++,(function(t){d?t():Promise.all(Ne.map(In)).then(t)})(()=>vn())})})();for(var bi=Array(256),Nt=0;256>Nt;++Nt)bi[Nt]=String.fromCharCode(Nt);qn=bi,je.push(0,1,void 0,1,null,1,!0,1,!1,1),i.count_emval_handles=()=>je.length/2-5-or.length,d||(j=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),W()),i.wasmBinary&&($=i.wasmBinary),i.stackSave=()=>_e(),i.stackRestore=e=>Te(e),i.stackAlloc=e=>Wt(e),i.setValue=function(e,t,r="i8"){switch(r.endsWith("*")&&(r="*"),r){case"i1":case"i8":re()[e>>>0]=t;break;case"i16":xe()[e>>>1>>>0]=t;break;case"i32":I()[e>>>2>>>0]=t;break;case"i64":ie[e>>>3]=BigInt(t);break;case"float":be()[e>>>2>>>0]=t;break;case"double":pe()[e>>>3>>>0]=t;break;case"*":x()[e>>>2>>>0]=t;break;default:Me(`invalid type for setValue: ${r}`)}},i.getValue=function(e,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":return re()[e>>>0];case"i16":return xe()[e>>>1>>>0];case"i32":return I()[e>>>2>>>0];case"i64":return ie[e>>>3];case"float":return be()[e>>>2>>>0];case"double":return pe()[e>>>3>>>0];case"*":return x()[e>>>2>>>0];default:Me(`invalid type for getValue: ${t}`)}},i.UTF8ToString=at,i.stringToUTF8=Pe,i.lengthBytesUTF8=$e;var vl=[rr,En,Un,Ln,jn,Pn,$n,kn,Dn,Nn,Wn,Gn,Fn,Vn,zn,Hn,ai,oi,si,ci,hi,yi,mi,gi,wi],wr={1048636:(e,t,r,a,s)=>{if(i===void 0||!i.fc)return 1;if((e=at(Number(e>>>0))).startsWith("./")&&(e=e.substring(2)),!(e=i.fc.get(e)))return 2;if(t=Number(t>>>0),r=Number(r>>>0),a=Number(a>>>0),t+r>e.byteLength)return 3;try{let f=e.subarray(t,t+r);switch(s){case 0:Y().set(f,a>>>0);break;case 1:i.Pc?i.Pc(a,f):i.jd(a,f);break;default:return 4}return 0}catch{return 4}},1049460:(e,t,r)=>{i.Rc(e,Y().subarray(t>>>0,t+r>>>0))},1049524:()=>i.ed(),1049566:e=>{i.Qc(e)},1049603:()=>typeof wasmOffsetConverter<"u"};function Cl(){return typeof wasmOffsetConverter<"u"}var g=await(async function(){function e(a,s){return g=a.exports,g=(function(){var f=g,h={};for(let[m,w]of Object.entries(f))h[m]=typeof w=="function"?(...T)=>{Lt.push(m);try{return w(...T)}finally{ae||(Lt.pop(),Se&&Ge===1&&Lt.length===0&&(Ge=0,Q+=1,Mt(Fi),typeof Fibers<"u"&&Fibers.od()))}}:w;return h})(),g=(function(){var f=g,h=w=>T=>w(T)>>>0,m=w=>()=>w()>>>0;return(f=Object.assign({},f)).ob=h(f.ob),f.Rb=m(f.Rb),f.Tb=h(f.Tb),f.Dc=(w=>(T,A)=>w(T,A)>>>0)(f.Dc),f.Gc=h(f.Gc),f.Hc=m(f.Hc),f.__cxa_get_exception_ptr=h(f.__cxa_get_exception_ptr),f})(),xn.push(g.vc),M=s,vn(),g}Re++;var t=Cn();if(i.instantiateWasm)return new Promise(a=>{i.instantiateWasm(t,(s,f)=>{a(e(s,f))})});if(d)return new Promise(a=>{yt=s=>{var f=new WebAssembly.Instance(s,Cn());a(e(f,s))}});He??=i.locateFile?i.locateFile?i.locateFile("ort-wasm-simd-threaded.asyncify.wasm",R):R+"ort-wasm-simd-threaded.asyncify.wasm":new URL("/slate/assets/ort-wasm-simd-threaded.asyncify-BJtBjfiH.wasm",import.meta.url).href;try{var r=await(async function(a){var s=He;if(!$&&typeof WebAssembly.instantiateStreaming=="function"&&!K(s))try{var f=fetch(s,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(f,a)}catch(h){k(`wasm streaming compile failed: ${h}`),k("falling back to ArrayBuffer instantiation")}return(async function(h,m){try{var w=await(async function(T){if(!$)try{var A=await v(T);return new Uint8Array(A)}catch{}if(T==He&&$)T=new Uint8Array($);else{if(!C)throw"both async and sync fetching of the wasm failed";T=C(T)}return T})(h);return await WebAssembly.instantiate(w,m)}catch(T){k(`failed to asynchronously prepare wasm: ${T}`),Me(T)}})(s,a)})(t);return e(r.instance,r.module)}catch(a){return l(a),Promise.reject(a)}})(),vi=e=>(vi=g.ob)(e),Ci=()=>(Ci=g.pb)();i._OrtInit=(e,t)=>(i._OrtInit=g.qb)(e,t),i._OrtGetLastError=(e,t)=>(i._OrtGetLastError=g.rb)(e,t),i._OrtCreateSessionOptions=(e,t,r,a,s,f,h,m,w,T)=>(i._OrtCreateSessionOptions=g.sb)(e,t,r,a,s,f,h,m,w,T),i._OrtAppendExecutionProvider=(e,t,r,a,s)=>(i._OrtAppendExecutionProvider=g.tb)(e,t,r,a,s),i._OrtAddFreeDimensionOverride=(e,t,r)=>(i._OrtAddFreeDimensionOverride=g.ub)(e,t,r),i._OrtAddSessionConfigEntry=(e,t,r)=>(i._OrtAddSessionConfigEntry=g.vb)(e,t,r),i._OrtReleaseSessionOptions=e=>(i._OrtReleaseSessionOptions=g.wb)(e),i._OrtCreateSession=(e,t,r)=>(i._OrtCreateSession=g.xb)(e,t,r),i._OrtReleaseSession=e=>(i._OrtReleaseSession=g.yb)(e),i._OrtGetInputOutputCount=(e,t,r)=>(i._OrtGetInputOutputCount=g.zb)(e,t,r),i._OrtGetInputOutputMetadata=(e,t,r,a)=>(i._OrtGetInputOutputMetadata=g.Ab)(e,t,r,a),i._OrtFree=e=>(i._OrtFree=g.Bb)(e),i._OrtCreateTensor=(e,t,r,a,s,f)=>(i._OrtCreateTensor=g.Cb)(e,t,r,a,s,f),i._OrtGetTensorData=(e,t,r,a,s)=>(i._OrtGetTensorData=g.Db)(e,t,r,a,s),i._OrtReleaseTensor=e=>(i._OrtReleaseTensor=g.Eb)(e),i._OrtCreateRunOptions=(e,t,r,a)=>(i._OrtCreateRunOptions=g.Fb)(e,t,r,a),i._OrtAddRunConfigEntry=(e,t,r)=>(i._OrtAddRunConfigEntry=g.Gb)(e,t,r),i._OrtReleaseRunOptions=e=>(i._OrtReleaseRunOptions=g.Hb)(e),i._OrtCreateBinding=e=>(i._OrtCreateBinding=g.Ib)(e),i._OrtBindInput=(e,t,r)=>(i._OrtBindInput=g.Jb)(e,t,r),i._OrtBindOutput=(e,t,r,a)=>(i._OrtBindOutput=g.Kb)(e,t,r,a),i._OrtClearBoundOutputs=e=>(i._OrtClearBoundOutputs=g.Lb)(e),i._OrtReleaseBinding=e=>(i._OrtReleaseBinding=g.Mb)(e),i._OrtRunWithBinding=(e,t,r,a,s)=>(i._OrtRunWithBinding=g.Nb)(e,t,r,a,s),i._OrtRun=(e,t,r,a,s,f,h,m)=>(i._OrtRun=g.Ob)(e,t,r,a,s,f,h,m),i._OrtEndProfiling=e=>(i._OrtEndProfiling=g.Pb)(e);var br=i._OrtGetWebGpuDevice=e=>(br=i._OrtGetWebGpuDevice=g.Qb)(e),vr=()=>(vr=g.Rb)(),Ae=i._free=e=>(Ae=i._free=g.Sb)(e),lt=i._malloc=e=>(lt=i._malloc=g.Tb)(e),Ti=i._wgpuBufferRelease=e=>(Ti=i._wgpuBufferRelease=g.Ub)(e),_i=i._wgpuCreateInstance=e=>(_i=i._wgpuCreateInstance=g.Vb)(e),Ei=e=>(Ei=g.Wb)(e),xi=e=>(xi=g.Xb)(e),Ai=e=>(Ai=g.Yb)(e),Oi=e=>(Oi=g.Zb)(e),Ii=e=>(Ii=g._b)(e),Si=e=>(Si=g.$b)(e),Ui=e=>(Ui=g.bc)(e),Bi=(e,t)=>(Bi=g.lc)(e,t),Ri=(e,t)=>(Ri=g.mc)(e,t),Mi=e=>(Mi=g.nc)(e),Cr=(e,t,r)=>(Cr=g.pc)(e,t,r),Tr=(e,t,r)=>(Tr=g.qc)(e,t,r),_r=(e,t,r,a)=>(_r=g.rc)(e,t,r,a),Ct=(e,t,r,a)=>(Ct=g.sc)(e,t,r,a),Er=(e,t,r,a)=>(Er=g.tc)(e,t,r,a),Li=(e,t,r)=>(Li=g.uc)(e,t,r),xr=(e,t,r,a,s,f)=>(xr=g.wc)(e,t,r,a,s,f),ji=()=>(ji=g.xc)(),Pi=(e,t,r,a,s)=>(Pi=g.yc)(e,t,r,a,s),$i=e=>($i=g.zc)(e),Ar=e=>(Ar=g.Ac)(e),ki=(e,t)=>(ki=g.Bc)(e,t),Di=()=>(Di=g.Cc)(),Or=(e,t)=>(Or=g.Dc)(e,t),Ni=(e,t)=>(Ni=g.Ec)(e,t),Te=e=>(Te=g.Fc)(e),Wt=e=>(Wt=g.Gc)(e),_e=()=>(_e=g.Hc)(),Wi=i.dynCall_ii=(e,t)=>(Wi=i.dynCall_ii=g.Ic)(e,t);i.dynCall_viiii=(e,t,r,a,s)=>(i.dynCall_viiii=g.dynCall_viiii)(e,t,r,a,s),i.dynCall_viiiii=(e,t,r,a,s,f)=>(i.dynCall_viiiii=g.dynCall_viiiii)(e,t,r,a,s,f),i.dynCall_viii=(e,t,r,a)=>(i.dynCall_viii=g.Jc)(e,t,r,a),i.dynCall_vi=(e,t)=>(i.dynCall_vi=g.dynCall_vi)(e,t),i.dynCall_viijj=(e,t,r,a,s)=>(i.dynCall_viijj=g.dynCall_viijj)(e,t,r,a,s),i.dynCall_viiiiii=(e,t,r,a,s,f,h)=>(i.dynCall_viiiiii=g.dynCall_viiiiii)(e,t,r,a,s,f,h),i.dynCall_viiiiiiii=(e,t,r,a,s,f,h,m,w)=>(i.dynCall_viiiiiiii=g.dynCall_viiiiiiii)(e,t,r,a,s,f,h,m,w),i.dynCall_i=e=>(i.dynCall_i=g.dynCall_i)(e),i.dynCall_vii=(e,t,r)=>(i.dynCall_vii=g.dynCall_vii)(e,t,r),i.dynCall_fffffff=(e,t,r,a,s,f,h)=>(i.dynCall_fffffff=g.dynCall_fffffff)(e,t,r,a,s,f,h),i.dynCall_iiiii=(e,t,r,a,s)=>(i.dynCall_iiiii=g.dynCall_iiiii)(e,t,r,a,s),i.dynCall_iii=(e,t,r)=>(i.dynCall_iii=g.dynCall_iii)(e,t,r),i.dynCall_iiiiii=(e,t,r,a,s,f)=>(i.dynCall_iiiiii=g.dynCall_iiiiii)(e,t,r,a,s,f),i.dynCall_iiiiiiii=(e,t,r,a,s,f,h,m)=>(i.dynCall_iiiiiiii=g.dynCall_iiiiiiii)(e,t,r,a,s,f,h,m),i.dynCall_iiiiiii=(e,t,r,a,s,f,h)=>(i.dynCall_iiiiiii=g.dynCall_iiiiiii)(e,t,r,a,s,f,h),i.dynCall_iiii=(e,t,r,a)=>(i.dynCall_iiii=g.dynCall_iiii)(e,t,r,a),i.dynCall_vfiii=(e,t,r,a,s)=>(i.dynCall_vfiii=g.dynCall_vfiii)(e,t,r,a,s),i.dynCall_viiiiff=(e,t,r,a,s,f,h)=>(i.dynCall_viiiiff=g.dynCall_viiiiff)(e,t,r,a,s,f,h),i.dynCall_viiiiiff=(e,t,r,a,s,f,h,m)=>(i.dynCall_viiiiiff=g.dynCall_viiiiiff)(e,t,r,a,s,f,h,m),i.dynCall_ffff=(e,t,r,a)=>(i.dynCall_ffff=g.dynCall_ffff)(e,t,r,a),i.dynCall_viiff=(e,t,r,a,s)=>(i.dynCall_viiff=g.dynCall_viiff)(e,t,r,a,s),i.dynCall_jjjjjjj=(e,t,r,a,s,f,h)=>(i.dynCall_jjjjjjj=g.dynCall_jjjjjjj)(e,t,r,a,s,f,h),i.dynCall_jjjjjj=(e,t,r,a,s,f)=>(i.dynCall_jjjjjj=g.dynCall_jjjjjj)(e,t,r,a,s,f),i.dynCall_iijjii=(e,t,r,a,s,f)=>(i.dynCall_iijjii=g.dynCall_iijjii)(e,t,r,a,s,f),i.dynCall_viiiiiiiiiiiii=(e,t,r,a,s,f,h,m,w,T,A,E,B,G)=>(i.dynCall_viiiiiiiiiiiii=g.dynCall_viiiiiiiiiiiii)(e,t,r,a,s,f,h,m,w,T,A,E,B,G),i.dynCall_viiiiiiiiii=(e,t,r,a,s,f,h,m,w,T,A)=>(i.dynCall_viiiiiiiiii=g.dynCall_viiiiiiiiii)(e,t,r,a,s,f,h,m,w,T,A),i.dynCall_viiiiiiiiiii=(e,t,r,a,s,f,h,m,w,T,A,E)=>(i.dynCall_viiiiiiiiiii=g.dynCall_viiiiiiiiiii)(e,t,r,a,s,f,h,m,w,T,A,E),i.dynCall_viiiiiiiiiiii=(e,t,r,a,s,f,h,m,w,T,A,E,B)=>(i.dynCall_viiiiiiiiiiii=g.dynCall_viiiiiiiiiiii)(e,t,r,a,s,f,h,m,w,T,A,E,B),i.dynCall_viiiiiiiiiiiiiiiiii=(e,t,r,a,s,f,h,m,w,T,A,E,B,G,V,de,Oe,Ze,Tt)=>(i.dynCall_viiiiiiiiiiiiiiiiii=g.dynCall_viiiiiiiiiiiiiiiiii)(e,t,r,a,s,f,h,m,w,T,A,E,B,G,V,de,Oe,Ze,Tt),i.dynCall_viiiiiiiii=(e,t,r,a,s,f,h,m,w,T)=>(i.dynCall_viiiiiiiii=g.dynCall_viiiiiiiii)(e,t,r,a,s,f,h,m,w,T),i.dynCall_viiiiiiiiiiiiiiiiiii=(e,t,r,a,s,f,h,m,w,T,A,E,B,G,V,de,Oe,Ze,Tt,Ir)=>(i.dynCall_viiiiiiiiiiiiiiiiiii=g.dynCall_viiiiiiiiiiiiiiiiiii)(e,t,r,a,s,f,h,m,w,T,A,E,B,G,V,de,Oe,Ze,Tt,Ir),i.dynCall_viiiiiii=(e,t,r,a,s,f,h,m)=>(i.dynCall_viiiiiii=g.dynCall_viiiiiii)(e,t,r,a,s,f,h,m),i.dynCall_viiiiiiiiiiiiiii=(e,t,r,a,s,f,h,m,w,T,A,E,B,G,V,de)=>(i.dynCall_viiiiiiiiiiiiiii=g.dynCall_viiiiiiiiiiiiiii)(e,t,r,a,s,f,h,m,w,T,A,E,B,G,V,de),i.dynCall_jiji=(e,t,r,a)=>(i.dynCall_jiji=g.dynCall_jiji)(e,t,r,a),i.dynCall_v=e=>(i.dynCall_v=g.dynCall_v)(e),i.dynCall_iidiiii=(e,t,r,a,s,f,h)=>(i.dynCall_iidiiii=g.dynCall_iidiiii)(e,t,r,a,s,f,h),i.dynCall_ji=(e,t)=>(i.dynCall_ji=g.dynCall_ji)(e,t),i.dynCall_vij=(e,t,r)=>(i.dynCall_vij=g.dynCall_vij)(e,t,r),i.dynCall_viiijii=(e,t,r,a,s,f,h)=>(i.dynCall_viiijii=g.dynCall_viiijii)(e,t,r,a,s,f,h),i.dynCall_viijiiiiiiiiiiiiii=(e,t,r,a,s,f,h,m,w,T,A,E,B,G,V,de,Oe,Ze)=>(i.dynCall_viijiiiiiiiiiiiiii=g.dynCall_viijiiiiiiiiiiiiii)(e,t,r,a,s,f,h,m,w,T,A,E,B,G,V,de,Oe,Ze),i.dynCall_viiiji=(e,t,r,a,s,f)=>(i.dynCall_viiiji=g.dynCall_viiiji)(e,t,r,a,s,f),i.dynCall_jfi=(e,t,r)=>(i.dynCall_jfi=g.dynCall_jfi)(e,t,r),i.dynCall_fif=(e,t,r)=>(i.dynCall_fif=g.dynCall_fif)(e,t,r),i.dynCall_jii=(e,t,r)=>(i.dynCall_jii=g.dynCall_jii)(e,t,r),i.dynCall_viiiijii=(e,t,r,a,s,f,h,m)=>(i.dynCall_viiiijii=g.dynCall_viiiijii)(e,t,r,a,s,f,h,m),i.dynCall_iij=(e,t,r)=>(i.dynCall_iij=g.dynCall_iij)(e,t,r),i.dynCall_viji=(e,t,r,a)=>(i.dynCall_viji=g.dynCall_viji)(e,t,r,a),i.dynCall_iiiiiiiii=(e,t,r,a,s,f,h,m,w)=>(i.dynCall_iiiiiiiii=g.dynCall_iiiiiiiii)(e,t,r,a,s,f,h,m,w),i.dynCall_iiij=(e,t,r,a)=>(i.dynCall_iiij=g.dynCall_iiij)(e,t,r,a),i.dynCall_iiiiiiiiii=(e,t,r,a,s,f,h,m,w,T)=>(i.dynCall_iiiiiiiiii=g.dynCall_iiiiiiiiii)(e,t,r,a,s,f,h,m,w,T),i.dynCall_iiiiiiiiiiiii=(e,t,r,a,s,f,h,m,w,T,A,E,B)=>(i.dynCall_iiiiiiiiiiiii=g.dynCall_iiiiiiiiiiiii)(e,t,r,a,s,f,h,m,w,T,A,E,B),i.dynCall_iiiiiiiiiii=(e,t,r,a,s,f,h,m,w,T,A)=>(i.dynCall_iiiiiiiiiii=g.dynCall_iiiiiiiiiii)(e,t,r,a,s,f,h,m,w,T,A),i.dynCall_iijii=(e,t,r,a,s)=>(i.dynCall_iijii=g.dynCall_iijii)(e,t,r,a,s),i.dynCall_fiii=(e,t,r,a)=>(i.dynCall_fiii=g.dynCall_fiii)(e,t,r,a),i.dynCall_viijii=(e,t,r,a,s,f)=>(i.dynCall_viijii=g.dynCall_viijii)(e,t,r,a,s,f),i.dynCall_viij=(e,t,r,a)=>(i.dynCall_viij=g.dynCall_viij)(e,t,r,a),i.dynCall_jiij=(e,t,r,a)=>(i.dynCall_jiij=g.dynCall_jiij)(e,t,r,a),i.dynCall_fi=(e,t)=>(i.dynCall_fi=g.dynCall_fi)(e,t),i.dynCall_fii=(e,t,r)=>(i.dynCall_fii=g.dynCall_fii)(e,t,r),i.dynCall_dii=(e,t,r)=>(i.dynCall_dii=g.dynCall_dii)(e,t,r),i.dynCall_fiiii=(e,t,r,a,s)=>(i.dynCall_fiiii=g.dynCall_fiiii)(e,t,r,a,s),i.dynCall_viiiiiiiiiiiiii=(e,t,r,a,s,f,h,m,w,T,A,E,B,G,V)=>(i.dynCall_viiiiiiiiiiiiii=g.dynCall_viiiiiiiiiiiiii)(e,t,r,a,s,f,h,m,w,T,A,E,B,G,V),i.dynCall_viiiiiiiiiiiiiiiiiiii=(e,t,r,a,s,f,h,m,w,T,A,E,B,G,V,de,Oe,Ze,Tt,Ir,Tl)=>(i.dynCall_viiiiiiiiiiiiiiiiiiii=g.dynCall_viiiiiiiiiiiiiiiiiiii)(e,t,r,a,s,f,h,m,w,T,A,E,B,G,V,de,Oe,Ze,Tt,Ir,Tl),i.dynCall_viiiiiiiiiiiiiiii=(e,t,r,a,s,f,h,m,w,T,A,E,B,G,V,de,Oe)=>(i.dynCall_viiiiiiiiiiiiiiii=g.dynCall_viiiiiiiiiiiiiiii)(e,t,r,a,s,f,h,m,w,T,A,E,B,G,V,de,Oe),i.dynCall_iif=(e,t,r)=>(i.dynCall_iif=g.dynCall_iif)(e,t,r),i.dynCall_jiiii=(e,t,r,a,s)=>(i.dynCall_jiiii=g.dynCall_jiiii)(e,t,r,a,s),i.dynCall_jiii=(e,t,r,a)=>(i.dynCall_jiii=g.dynCall_jiii)(e,t,r,a),i.dynCall_viif=(e,t,r,a)=>(i.dynCall_viif=g.dynCall_viif)(e,t,r,a),i.dynCall_viiij=(e,t,r,a,s)=>(i.dynCall_viiij=g.dynCall_viiij)(e,t,r,a,s),i.dynCall_iiiiij=(e,t,r,a,s,f)=>(i.dynCall_iiiiij=g.dynCall_iiiiij)(e,t,r,a,s,f),i.dynCall_iiiiid=(e,t,r,a,s,f)=>(i.dynCall_iiiiid=g.dynCall_iiiiid)(e,t,r,a,s,f),i.dynCall_iiiiijj=(e,t,r,a,s,f,h)=>(i.dynCall_iiiiijj=g.dynCall_iiiiijj)(e,t,r,a,s,f,h),i.dynCall_iiiiiijj=(e,t,r,a,s,f,h,m)=>(i.dynCall_iiiiiijj=g.dynCall_iiiiiijj)(e,t,r,a,s,f,h,m);var Gi=e=>(Gi=g.Kc)(e),Fi=()=>(Fi=g.Lc)(),Vi=e=>(Vi=g.Mc)(e),zi=()=>(zi=g.Nc)();return(function e(){if(0<Re)mt=e;else if(d)o(i),ve();else{for(;0<tr.length;)tr.shift()(i);0<Re?mt=e:(i.calledRun=!0,ae||(ve(),o(i)))}})(),i.PTR_SIZE=4,i.webgpuInit=e=>{let t=new WeakMap,r,a,s=1;i.webgpuRegisterDevice=m=>{if(a!==void 0)throw Error("another WebGPU EP inference session is being created.");if(m){var w=t.get(m);if(!w){let T=((A,E=0)=>{var B=Mi(E);return E=Ri(E,B),fe(B,A.queue),fe(E,A),E})(m,w=_i(0));w=[s++,w,T],t.set(m,w)}return r=m,a=w[0],w}r=void 0,a=0};let f=new Map;i.webgpuOnCreateSession=m=>{if(a!==void 0){var w=a;if(a=void 0,m){let T=br(w);f.set(m,T),w===0&&e(r??S(T))}r=void 0}},i.webgpuOnReleaseSession=m=>{f.delete(m)};let h=Symbol("gpuBufferMetadata");i.webgpuRegisterBuffer=(m,w,T)=>{if(T)return m[h]=[T,NaN],T;if(T=m[h])return T[1]++,T[0];if((w=f.get(w))===void 0)throw Error("Invalid session handle passed to webgpuRegisterBuffer");return w=((A,E=0)=>(A.mapState!="pending"||Me(),E=Bi(E,A.mapState=="mapped"?3:1),fe(E,A),A.mapState=="mapped"&&(Ue[E]=[]),E))(m,w),m[h]=[w,1],w},i.webgpuUnregisterBuffer=m=>{let w=m[h];if(!w)throw Error("Buffer is not registered");w[1]--,w[1]===0&&(Ti(w[0]),delete m[h])},i.webgpuGetBuffer=m=>S(m),i.webgpuCreateDownloader=(m,w,T)=>{if((T=f.get(T))===void 0)throw Error("Invalid session handle passed to webgpuRegisterBuffer");let A=S(T),E=16*Math.ceil(Number(w)/16);return async()=>{let B=A.createBuffer({size:E,usage:9});try{let G=A.createCommandEncoder();return G.copyBufferToBuffer(m,0,B,0,E),A.queue.submit([G.finish()]),await B.mapAsync(GPUMapMode.READ),B.getMappedRange().slice(0,w)}finally{B.destroy()}}},i.Pc=(m,w)=>{var T=w.buffer;let A=w.byteOffset,E=w.byteLength;if(w=16*Math.ceil(Number(E)/16),m=S(m),!r){var B=br(a);r=S(B)}let G=(B=r.createBuffer({mappedAtCreation:!0,size:w,usage:6})).getMappedRange();new Uint8Array(G).set(new Uint8Array(T,A,E)),B.unmap(),(T=r.createCommandEncoder()).copyBufferToBuffer(B,0,m,0,w),r.queue.submit([T.finish()]),B.destroy()}},i.webnnInit=e=>{let t=e[0];[i.ed,i.Qc,i.webnnEnsureTensor,i.Rc,i.webnnDownloadTensor,i.dd,i.webnnEnableTraceEvent]=e.slice(1),i.webnnReleaseTensorId=i.Qc,i.webnnUploadTensor=i.Rc,i.webnnRegisterMLContext=i.dd,i.webnnOnRunStart=r=>t.onRunStart(r),i.webnnOnRunEnd=t.onRunEnd.bind(t),i.webnnOnReleaseSession=r=>{t.onReleaseSession(r)},i.webnnCreateMLTensorDownloader=(r,a)=>t.createMLTensorDownloader(r,a),i.webnnRegisterMLTensor=(r,a,s,f)=>t.registerMLTensor(r,a,s,f),i.webnnCreateMLContext=r=>t.createMLContext(r),i.webnnRegisterMLConstant=(r,a,s,f,h,m)=>t.registerMLConstant(r,a,s,f,h,i.fc,m),i.webnnRegisterGraphInput=t.registerGraphInput.bind(t),i.webnnIsGraphInput=t.isGraphInput.bind(t),i.webnnRegisterGraphOutput=t.registerGraphOutput.bind(t),i.webnnIsGraphOutput=t.isGraphOutput.bind(t),i.webnnCreateTemporaryTensor=t.createTemporaryTensor.bind(t),i.webnnIsGraphInputOutputTypeSupported=t.isGraphInputOutputTypeSupported.bind(t)},u},Wa=Lr,qi=globalThis.self?.name?.startsWith("em-pthread"),qi&&Lr()}),jr,Qr,Zi,he,Ga,Ft,Xi,Yi,Pr,Ji,$r,Fa,kr,Va,sn=D(()=>{on(),jr=typeof location>"u"?void 0:location.origin,Qr=import.meta.url>"file:"&&import.meta.url<"file;",Zi=()=>{{if(Qr){let n=URL;return new URL(new n("ort.webgpu.bundle.min.mjs",import.meta.url).href,jr).href}return import.meta.url}},he=Zi(),Ga=()=>{if(he&&!he.startsWith("blob:"))return he.substring(0,he.lastIndexOf("/")+1)},Ft=(n,o)=>{try{let l=o??he;return(l?new URL(n,l):new URL(n)).origin===jr}catch{return!1}},Xi=(n,o)=>{let l=o??he;try{return(l?new URL(n,l):new URL(n)).href}catch{return}},Yi=(n,o)=>`${o??"./"}${n}`,Pr=async n=>{let o=await(await fetch(n,{credentials:"same-origin"})).blob();return URL.createObjectURL(o)},Ji=async n=>(await import(n)).default,$r=(Wl(),Yt(ka)).default,Fa=async()=>{if(!he)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(Ft(he))return[void 0,$r()];let n=await Pr(he);return[n,$r(n)]},kr=(Gl(),Yt(Na)).default,Va=async(n,o,l,i)=>{let u=kr&&!(n||o);if(u)if(he)u=Ft(he);else if(i&&!l)u=!0;else throw new Error("cannot determine the script source URL.");if(u)return[void 0,kr];{let p="ort-wasm-simd-threaded.asyncify.mjs",c=n??Xi(p,o),d=l&&c&&!Ft(c,o),y=d?await Pr(c):c??Yi(p,o);return[d?y:void 0,await Ji(y)]}}}),Dr,Vt,Et,Nr,Qi,Ki,ea,ln,H,rt=D(()=>{sn(),Vt=!1,Et=!1,Nr=!1,Qi=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},Ki=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},ea=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},ln=async n=>{if(Vt)return Promise.resolve();if(Et)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(Nr)throw new Error("previous call to 'initializeWebAssembly()' failed.");Et=!0;let o=n.initTimeout,l=n.numThreads;if(n.simd!==!1){if(n.simd==="relaxed"){if(!ea())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!Ki())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let i=Qi();l>1&&!i&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+l+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),n.numThreads=l=1);let u=n.wasmPaths,p=typeof u=="string"?u:void 0,c=u?.mjs,d=c?.href??c,y=u?.wasm,b=y?.href??y,v=n.wasmBinary,[C,_]=await Va(d,p,l>1,!!v||!!b),O=!1,R=[];if(o>0&&R.push(new Promise($=>{setTimeout(()=>{O=!0,$()},o)})),R.push(new Promise(($,j)=>{let M={numThreads:l};if(v)M.wasmBinary=v;else if(b||p)M.locateFile=U=>b??p+U;else if(d&&d.indexOf("blob:")!==0)M.locateFile=U=>new URL(U,d).href;else if(C){let U=Ga();U&&(M.locateFile=N=>U+N)}_(M).then(U=>{Et=!1,Vt=!0,Dr=U,$(),C&&URL.revokeObjectURL(C)},U=>{Et=!1,Nr=!0,j(U)})})),await Promise.race(R),O)throw new Error(`WebAssembly backend initializing failed due to timeout: ${o}ms`)},H=()=>{if(Vt&&Dr)return Dr;throw new Error("WebAssembly is not initialized yet.")}}),ye,Jt,z,un=D(()=>{rt(),ye=(n,o)=>{let l=H(),i=l.lengthBytesUTF8(n)+1,u=l._malloc(i);return l.stringToUTF8(n,u,i),o.push(u),u},Jt=(n,o,l,i)=>{if(typeof n=="object"&&n!==null){if(l.has(n))throw new Error("Circular reference in options");l.add(n)}Object.entries(n).forEach(([u,p])=>{let c=o?o+u:u;if(typeof p=="object")Jt(p,c+".",l,i);else if(typeof p=="string"||typeof p=="number")i(c,p.toString());else if(typeof p=="boolean")i(c,p?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof p}`)})},z=n=>{let o=H(),l=o.stackSave();try{let i=o.PTR_SIZE,u=o.stackAlloc(2*i);o._OrtGetLastError(u,u+i);let p=Number(o.getValue(u,i===4?"i32":"i64")),c=o.getValue(u+i,"*"),d=c?o.UTF8ToString(c):"";throw new Error(`${n} ERROR_CODE: ${p}, ERROR_MESSAGE: ${d}`)}finally{o.stackRestore(l)}}}),za,Fl=D(()=>{rt(),un(),za=n=>{let o=H(),l=0,i=[],u=n||{};try{if(n?.logSeverityLevel===void 0)u.logSeverityLevel=2;else if(typeof n.logSeverityLevel!="number"||!Number.isInteger(n.logSeverityLevel)||n.logSeverityLevel<0||n.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${n.logSeverityLevel}`);if(n?.logVerbosityLevel===void 0)u.logVerbosityLevel=0;else if(typeof n.logVerbosityLevel!="number"||!Number.isInteger(n.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${n.logVerbosityLevel}`);n?.terminate===void 0&&(u.terminate=!1);let p=0;return n?.tag!==void 0&&(p=ye(n.tag,i)),l=o._OrtCreateRunOptions(u.logSeverityLevel,u.logVerbosityLevel,!!u.terminate,p),l===0&&z("Can't create run options."),n?.extra!==void 0&&Jt(n.extra,"",new WeakSet,(c,d)=>{let y=ye(c,i),b=ye(d,i);o._OrtAddRunConfigEntry(l,y,b)!==0&&z(`Can't set a run config entry: ${c} - ${d}.`)}),[l,i]}catch(p){throw l!==0&&o._OrtReleaseRunOptions(l),i.forEach(c=>o._free(c)),p}}}),ta,ra,na,zt,Ht,ia,Ha,Vl=D(()=>{rt(),un(),ta=n=>{switch(n){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${n}`)}},ra=n=>{switch(n){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${n}`)}},na=n=>{n.extra||(n.extra={}),n.extra.session||(n.extra.session={});let o=n.extra.session;o.use_ort_model_bytes_directly||(o.use_ort_model_bytes_directly="1"),n.executionProviders&&n.executionProviders.some(l=>(typeof l=="string"?l:l.name)==="webgpu")&&(n.enableMemPattern=!1)},zt=(n,o,l,i)=>{let u=ye(o,i),p=ye(l,i);H()._OrtAddSessionConfigEntry(n,u,p)!==0&&z(`Can't set a session config entry: ${o} - ${l}.`)},Ht=(n,o,l,i)=>{let u=ye(o,i),p=ye(l,i);n.push([u,p])},ia=async(n,o,l)=>{for(let i of o){let u=typeof i=="string"?i:i.name,p=[];switch(u){case"webnn":if(u="WEBNN",typeof i!="string"){let v=i?.deviceType;v&&zt(n,"deviceType",v,l)}break;case"webgpu":{u="WebGPU";let v;if(typeof i!="string"){let _=i;if(_.device)if(typeof GPUDevice<"u"&&_.device instanceof GPUDevice)v=_.device;else throw new Error("Invalid GPU device set in WebGPU EP options.")}let C=H().webgpuRegisterDevice(v);if(C){let[_,O,R]=C;Ht(p,"deviceId",_.toString(),l),Ht(p,"webgpuInstance",O.toString(),l),Ht(p,"webgpuDevice",R.toString(),l)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${u}`)}let c=ye(u,l),d=p.length,y=0,b=0;if(d>0){y=H()._malloc(d*H().PTR_SIZE),l.push(y),b=H()._malloc(d*H().PTR_SIZE),l.push(b);for(let v=0;v<d;v++)H().setValue(y+v*H().PTR_SIZE,p[v][0],"*"),H().setValue(b+v*H().PTR_SIZE,p[v][1],"*")}await H()._OrtAppendExecutionProvider(n,c,y,b,d)!==0&&z(`Can't append execution provider: ${u}.`)}},Ha=async n=>{let o=H(),l=0,i=[],u=n||{};na(u);try{let p=ta(u.graphOptimizationLevel??"all"),c=ra(u.executionMode??"sequential"),d=typeof u.logId=="string"?ye(u.logId,i):0,y=u.logSeverityLevel??2;if(!Number.isInteger(y)||y<0||y>4)throw new Error(`log severity level is not valid: ${y}`);let b=u.logVerbosityLevel??0;if(!Number.isInteger(b)||b<0||b>4)throw new Error(`log verbosity level is not valid: ${b}`);let v=typeof u.optimizedModelFilePath=="string"?ye(u.optimizedModelFilePath,i):0;if(l=o._OrtCreateSessionOptions(p,!!u.enableCpuMemArena,!!u.enableMemPattern,c,!!u.enableProfiling,0,d,y,b,v),l===0&&z("Can't create session options."),u.executionProviders&&await ia(l,u.executionProviders,i),u.enableGraphCapture!==void 0){if(typeof u.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${u.enableGraphCapture}`);zt(l,"enableGraphCapture",u.enableGraphCapture.toString(),i)}if(u.freeDimensionOverrides)for(let[C,_]of Object.entries(u.freeDimensionOverrides)){if(typeof C!="string")throw new Error(`free dimension override name must be a string: ${C}`);if(typeof _!="number"||!Number.isInteger(_)||_<0)throw new Error(`free dimension override value must be a non-negative integer: ${_}`);let O=ye(C,i);o._OrtAddFreeDimensionOverride(l,O,_)!==0&&z(`Can't set a free dimension override: ${C} - ${_}.`)}return u.extra!==void 0&&Jt(u.extra,"",new WeakSet,(C,_)=>{zt(l,C,_,i)}),[l,i]}catch(p){throw l!==0&&o._OrtReleaseSessionOptions(l)!==0&&z("Can't release session options."),i.forEach(c=>o._free(c)),p}}}),Qe,Xt,ft,St,Qt,fn,dn,Kr,ht=D(()=>{Qe=n=>{switch(n){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${n}`)}},Xt=n=>{switch(n){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${n}`)}},ft=(n,o)=>{let l=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][n],i=typeof o=="number"?o:o.reduce((u,p)=>u*p,1);return l>0?Math.ceil(i*l):void 0},St=n=>{switch(n){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${n}`)}},Qt=n=>{switch(n){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${n}`)}},fn=n=>n==="float32"||n==="float16"||n==="int32"||n==="int64"||n==="uint32"||n==="uint8"||n==="bool"||n==="uint4"||n==="int4",dn=n=>n==="float32"||n==="float16"||n==="int32"||n==="int64"||n==="uint32"||n==="uint64"||n==="int8"||n==="uint8"||n==="bool"||n==="uint4"||n==="int4",Kr=n=>{switch(n){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${n}`)}}}),pn,qa=D(()=>{on(),pn=async n=>{if(typeof n=="string"){let o=await fetch(n);if(!o.ok)throw new Error(`failed to load external data file: ${n}`);let l=o.headers.get("Content-Length"),i=l?parseInt(l,10):0;if(i<1073741824)return new Uint8Array(await o.arrayBuffer());{if(!o.body)throw new Error(`failed to load external data file: ${n}, no response body.`);let u=o.body.getReader(),p;try{p=new ArrayBuffer(i)}catch(d){if(d instanceof RangeError){let y=Math.ceil(i/65536);p=new WebAssembly.Memory({initial:y,maximum:y}).buffer}else throw d}let c=0;for(;;){let{done:d,value:y}=await u.read();if(d)break;let b=y.byteLength;new Uint8Array(p,c,b).set(y),c+=b}return new Uint8Array(p,0,i)}}else return n instanceof Blob?new Uint8Array(await n.arrayBuffer()):n instanceof Uint8Array?n:new Uint8Array(n)}}),Za,zl=D(()=>{ht(),Za=(n,o)=>new(St(o))(n)}),aa,oa,sa,la,Xa,ua,le,Ya=D(()=>{ht(),aa=["V","I","W","E","F"],oa=(n,o)=>{console.log(`[${aa[n]},${new Date().toISOString()}]${o}`)},Xa=(n,o)=>{sa=n,la=o},ua=(n,o)=>{let l=Qt(n),i=Qt(sa);l>=i&&oa(l,typeof o=="function"?o():o)},le=(...n)=>{la&&ua(...n)}}),Wr,en,Gr,fa,Fr,da,Vr,zr,Hr,pa,Ja,Hl=D(()=>{ht(),Ya(),Wr=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),en=(n,o)=>{if(o==="int32")return n;let l=Wr.get(o);if(!l)throw new Error(`WebNN backend does not support data type: ${o}`);let i=l/8;if(n.byteLength%i!==0)throw new Error(`Invalid Uint8Array length - must be a multiple of ${i}.`);let u=n.byteLength/i,p=new(St(o))(n.buffer,n.byteOffset,u);switch(o){case"int64":case"uint64":{let c=new Int32Array(u);for(let d=0;d<u;d++){let y=p[d];if(y>2147483647n||y<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");c[d]=Number(y)}return new Uint8Array(c.buffer)}case"int8":case"uint8":case"uint32":{if(o==="uint32"&&p.some(d=>d>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let c=Int32Array.from(p,Number);return new Uint8Array(c.buffer)}default:throw new Error(`Unsupported data conversion from ${o} to 'int32'`)}},Gr=(n,o)=>{if(o==="int32")return n;if(n.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let l=n.byteLength/4,i=new Int32Array(n.buffer,n.byteOffset,l);switch(o){case"int64":{let u=BigInt64Array.from(i,BigInt);return new Uint8Array(u.buffer)}case"uint64":{if(i.some(p=>p<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let u=BigUint64Array.from(i,BigInt);return new Uint8Array(u.buffer)}case"int8":{if(i.some(p=>p<-128||p>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let u=Int8Array.from(i,Number);return new Uint8Array(u.buffer)}case"uint8":{if(i.some(u=>u<0||u>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(i,Number)}case"uint32":{if(i.some(p=>p<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let u=Uint32Array.from(i,Number);return new Uint8Array(u.buffer)}default:throw new Error(`Unsupported data conversion from 'int32' to ${o}`)}},fa=1,Fr=()=>fa++,da=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),Vr=(n,o)=>{let l=Wr.get(n);if(!l)throw new Error(`WebNN backend does not support data type: ${n}`);return o.length>0?Math.ceil(o.reduce((i,u)=>i*u)*l/8):0},zr=class{constructor(n){this.isDataConverted=!1;let{sessionId:o,context:l,tensor:i,dataType:u,shape:p,fallbackDataType:c}=n;this.sessionId=o,this.mlContext=l,this.mlTensor=i,this.dataType=u,this.tensorShape=p,this.fallbackDataType=c}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return Vr(this.dataType,this.tensorShape)}destroy(){le("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(n){this.mlContext.writeTensor(this.mlTensor,n)}async read(n){if(this.fallbackDataType){let o=await this.mlContext.readTensor(this.mlTensor),l=Gr(new Uint8Array(o),this.dataType);if(n){(n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)).set(l);return}else return l.buffer}else return n?this.mlContext.readTensor(this.mlTensor,n):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(n,o,l){return this.mlContext===n&&this.dataType===o&&this.tensorShape.length===l.length&&this.tensorShape.every((i,u)=>i===l[u])}setIsDataConverted(n){this.isDataConverted=n}},Hr=class{constructor(n,o){this.tensorManager=n,this.wrapper=o}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(n,o,l,i){let u=this.tensorManager.getMLContext(n),p;if(!u.opSupportLimits().input.dataTypes.includes(o)){if(p=da.get(o),!p||!u.opSupportLimits().input.dataTypes.includes(p))throw new Error(`WebNN backend does not support data type: ${o}`);le("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${o} to ${p}`)}if(this.wrapper){if(this.wrapper.canReuseTensor(u,o,l))return this.wrapper.tensor;if(i){if(this.wrapper.byteLength!==Vr(o,l))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let c=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(n,o,l,c,!0,!0,p),i&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(n){let o=n;if(this.wrapper){if(this.wrapper.fallbackType)if(this.wrapper.fallbackType==="int32")o=en(n,this.wrapper.type),this.wrapper.setIsDataConverted(!0);else throw new Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);if(n.byteLength===this.wrapper.byteLength){this.wrapper.write(o);return}else le("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(o):this.activeUpload=new Uint8Array(o)}async download(n){if(this.activeUpload){let o=this.wrapper?.isDataConverted?Gr(this.activeUpload,this.wrapper?.type):this.activeUpload;if(n){n instanceof ArrayBuffer?new Uint8Array(n).set(o):new Uint8Array(n.buffer,n.byteOffset,n.byteLength).set(o);return}else return o.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return n?this.wrapper.read(n):this.wrapper.read()}},pa=class{constructor(n){this.backend=n,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(n){let o=this.backend.getMLContext(n);if(!o)throw new Error("MLContext not found for session.");return o}reserveTensorId(){let n=Fr();return this.tensorTrackersById.set(n,new Hr(this)),n}releaseTensorId(n){let o=this.tensorTrackersById.get(n);o&&(this.tensorTrackersById.delete(n),o.tensorWrapper&&this.releaseTensor(o.tensorWrapper))}async ensureTensor(n,o,l,i,u){le("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${o}, dataType: ${l}, shape: ${i}, copyOld: ${u}}`);let p=this.tensorTrackersById.get(o);if(!p)throw new Error("Tensor not found.");return p.ensureTensor(n,l,i,u)}upload(n,o){let l=this.tensorTrackersById.get(n);if(!l)throw new Error("Tensor not found.");l.upload(o)}async download(n,o){le("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${n}, dstBuffer: ${o?.byteLength}}`);let l=this.tensorTrackersById.get(n);if(!l)throw new Error("Tensor not found.");return l.download(o)}releaseTensorsForSession(n){for(let o of this.freeTensors)o.sessionId===n&&o.destroy();this.freeTensors=this.freeTensors.filter(o=>o.sessionId!==n)}registerTensor(n,o,l,i){let u=this.getMLContext(n),p=Fr(),c=new zr({sessionId:n,context:u,tensor:o,dataType:l,shape:i});return this.tensorTrackersById.set(p,new Hr(this,c)),this.externalTensors.add(c),p}async getCachedTensor(n,o,l,i,u,p,c){let d=this.getMLContext(n);for(let[b,v]of this.freeTensors.entries())if(v.canReuseTensor(d,o,l)){le("verbose",()=>`[WebNN] Reusing tensor {dataType: ${o}, ${c?`fallbackDataType: ${c},`:""} shape: ${l}`);let C=this.freeTensors.splice(b,1)[0];return C.sessionId=n,C}le("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${o}, ${c?`fallbackDataType: ${c},`:""} shape: ${l}}`);let y=await d.createTensor({dataType:c??o,shape:l,dimensions:l,usage:i,writable:u,readable:p});return new zr({sessionId:n,context:d,tensor:y,dataType:o,shape:l,fallbackDataType:c})}releaseTensor(n){this.externalTensors.has(n)&&this.externalTensors.delete(n),this.freeTensors.push(n)}},Ja=(...n)=>new pa(...n)}),Qa={};Ut(Qa,{WebNNBackend:()=>Ka});var xt,ca,Ka,ql=D(()=>{ht(),rt(),zl(),Hl(),Ya(),xt=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),ca=(n,o)=>{if(n===o)return!0;if(n===void 0||o===void 0)return!1;let l=Object.keys(n).sort(),i=Object.keys(o).sort();return l.length===i.length&&l.every((u,p)=>u===i[p]&&n[u]===o[u])},Ka=class{constructor(n){this.tensorManager=Ja(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.sessionGraphOutputs=new Map,this.temporaryGraphInputs=[],this.temporaryGraphOutputs=[],this.temporarySessionTensorIds=new Map,Xa(n.logLevel,!!n.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(n){le("verbose",()=>`[WebNN] onRunStart {sessionId: ${n}}`),this.activeSessionId=n}onRunEnd(n){le("verbose",()=>`[WebNN] onRunEnd {sessionId: ${n}}`);let o=this.temporarySessionTensorIds.get(n);if(o){for(let l of o)le("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${l}}`),this.tensorManager.releaseTensorId(l);this.temporarySessionTensorIds.delete(n),this.activeSessionId=void 0}}async createMLContext(n){if(n instanceof GPUDevice){let l=this.mlContextCache.findIndex(i=>i.gpuDevice===n);if(l!==-1)return this.mlContextCache[l].mlContext;{let i=await navigator.ml.createContext(n);return this.mlContextCache.push({gpuDevice:n,mlContext:i}),i}}else if(n===void 0){let l=this.mlContextCache.findIndex(i=>i.options===void 0&&i.gpuDevice===void 0);if(l!==-1)return this.mlContextCache[l].mlContext;{let i=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:i}),i}}let o=this.mlContextCache.findIndex(l=>ca(l.options,n));if(o!==-1)return this.mlContextCache[o].mlContext;{let l=await navigator.ml.createContext(n);return this.mlContextCache.push({options:n,mlContext:l}),l}}registerMLContext(n,o){this.mlContextBySessionId.set(n,o);let l=this.sessionIdsByMLContext.get(o);l||(l=new Set,this.sessionIdsByMLContext.set(o,l)),l.add(n),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(n,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(n,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(n){this.sessionGraphInputs.delete(n),this.sessionGraphOutputs.delete(n);let o=this.mlContextBySessionId.get(n);if(!o)return;this.tensorManager.releaseTensorsForSession(n),this.mlContextBySessionId.delete(n);let l=this.sessionIdsByMLContext.get(o);if(l.delete(n),l.size===0){this.sessionIdsByMLContext.delete(o);let i=this.mlContextCache.findIndex(u=>u.mlContext===o);i!==-1&&this.mlContextCache.splice(i,1)}}getMLContext(n){return this.mlContextBySessionId.get(n)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(n){le("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${n}}`),this.tensorManager.releaseTensorId(n)}async ensureTensor(n,o,l,i,u){let p=xt.get(l);if(!p)throw new Error(`Unsupported ONNX data type: ${l}`);return this.tensorManager.ensureTensor(n??this.currentSessionId,o,p,i,u)}async createTemporaryTensor(n,o,l){le("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${o}, shape: ${l}}`);let i=xt.get(o);if(!i)throw new Error(`Unsupported ONNX data type: ${o}`);let u=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(n,u,i,l,!1);let p=this.temporarySessionTensorIds.get(n);return p?p.push(u):this.temporarySessionTensorIds.set(n,[u]),u}uploadTensor(n,o){if(!H().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");le("verbose",()=>`[WebNN] uploadTensor {tensorId: ${n}, data: ${o.byteLength}}`),this.tensorManager.upload(n,o)}async downloadTensor(n,o){return this.tensorManager.download(n,o)}createMLTensorDownloader(n,o){return async()=>{let l=await this.tensorManager.download(n);return Za(l,o)}}registerMLTensor(n,o,l,i){let u=xt.get(l);if(!u)throw new Error(`Unsupported ONNX data type: ${l}`);let p=this.tensorManager.registerTensor(n,o,u,i);return le("verbose",()=>`[WebNN] registerMLTensor {tensor: ${o}, dataType: ${u}, dimensions: ${i}} -> {tensorId: ${p}}`),p}registerMLConstant(n,o,l,i,u,p,c=!1){if(!p)throw new Error("External mounted files are not available.");let d=n;n.startsWith("./")&&(d=n.substring(2));let y=p.get(d);if(!y)throw new Error(`File with name ${d} not found in preloaded files.`);if(o+l>y.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let b=y.slice(o,o+l).buffer,v;switch(u.dataType){case"float32":v=new Float32Array(b);break;case"float16":v=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(b):new Uint16Array(b);break;case"int32":v=new Int32Array(b);break;case"uint32":v=new Uint32Array(b);break;case"int64":if(c){let C=en(new Uint8Array(b),"int64");v=new Int32Array(C.buffer),u.dataType="int32"}else v=new BigInt64Array(b);break;case"uint64":v=new BigUint64Array(b);break;case"int8":v=new Int8Array(b);break;case"int4":case"uint4":case"uint8":v=new Uint8Array(b);break;default:throw new Error(`Unsupported data type: ${u.dataType} in creating WebNN Constant from external data.`)}return le("verbose",()=>`[WebNN] registerMLConstant {dataType: ${u.dataType}, shape: ${u.shape}}} ${c?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),i.constant(u,v)}registerGraphInput(n){this.temporaryGraphInputs.push(n)}registerGraphOutput(n){this.temporaryGraphOutputs.push(n)}isGraphInput(n,o){let l=this.sessionGraphInputs.get(n);return l?l.includes(o):!1}isGraphOutput(n,o){let l=this.sessionGraphOutputs.get(n);return l?l.includes(o):!1}isGraphInputOutputTypeSupported(n,o,l=!0){let i=this.mlContextBySessionId.get(n),u=xt.get(Qe(o));return typeof u>"u"?!1:l?!!i?.opSupportLimits().input.dataTypes.includes(u):!!i?.opSupportLimits().output.dataTypes.includes(u)}flush(){}}}),ha,cn,hn,Ve,ya,qr,Kt,yn,mn,Zr,gn,wn,bn,eo=D(()=>{tt(),Fl(),Vl(),ht(),rt(),un(),qa(),ha=(n,o)=>{H()._OrtInit(n,o)!==0&&z("Can't initialize onnxruntime.")},cn=async n=>{ha(n.wasm.numThreads,Qt(n.logLevel))},hn=async(n,o)=>{H().asyncInit?.();let l=n.webgpu.adapter;if(o==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(l){if(typeof l.limits!="object"||typeof l.features!="object"||typeof l.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let i=n.webgpu.powerPreference;if(i!==void 0&&i!=="low-power"&&i!=="high-performance")throw new Error(`Invalid powerPreference setting: "${i}"`);let u=n.webgpu.forceFallbackAdapter;if(u!==void 0&&typeof u!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${u}"`);if(l=await navigator.gpu.requestAdapter({powerPreference:i,forceFallbackAdapter:u}),!l)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if(o==="webnn"&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment");if(o==="webgpu"&&H().webgpuInit(i=>{n.webgpu.device=i}),o==="webnn"){let i=new(ql(),Yt(Qa)).WebNNBackend(n);H().webnnInit([i,()=>i.reserveTensorId(),u=>i.releaseTensorId(u),async(u,p,c,d,y)=>i.ensureTensor(u,p,c,d,y),(u,p)=>{i.uploadTensor(u,p)},async(u,p)=>i.downloadTensor(u,p),(u,p)=>i.registerMLContext(u,p),!!n.trace])}},Ve=new Map,ya=n=>{let o=H(),l=o.stackSave();try{let i=o.PTR_SIZE,u=o.stackAlloc(2*i);o._OrtGetInputOutputCount(n,u,u+i)!==0&&z("Can't get session input/output count.");let p=i===4?"i32":"i64";return[Number(o.getValue(u,p)),Number(o.getValue(u+i,p))]}finally{o.stackRestore(l)}},qr=(n,o)=>{let l=H(),i=l.stackSave(),u=0;try{let p=l.PTR_SIZE,c=l.stackAlloc(2*p);l._OrtGetInputOutputMetadata(n,o,c,c+p)!==0&&z("Can't get session input/output metadata.");let d=Number(l.getValue(c,"*"));u=Number(l.getValue(c+p,"*"));let y=l.HEAP32[u/4];if(y===0)return[d,0];let b=l.HEAPU32[u/4+1],v=[];for(let C=0;C<b;C++){let _=Number(l.getValue(u+8+C*p,"*"));v.push(_!==0?l.UTF8ToString(_):Number(l.getValue(u+8+(C+b)*p,"*")))}return[d,y,v]}finally{l.stackRestore(i),u!==0&&l._OrtFree(u)}},Kt=n=>{let o=H(),l=o._malloc(n.byteLength);if(l===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${n.byteLength}.`);return o.HEAPU8.set(n,l),[l,n.byteLength]},yn=async(n,o)=>{let l,i,u=H();Array.isArray(n)?[l,i]=n:n.buffer===u.HEAPU8.buffer?[l,i]=[n.byteOffset,n.byteLength]:[l,i]=Kt(n);let p=0,c=0,d=0,y=[],b=[],v=[];try{if([c,y]=await Ha(o),o?.externalData&&u.mountExternalData){let L=[];for(let F of o.externalData){let ne=typeof F=="string"?F:F.path;L.push(pn(typeof F=="string"?F:F.data).then(se=>{u.mountExternalData(ne,se)}))}await Promise.all(L)}for(let L of o?.executionProviders??[])if((typeof L=="string"?L:L.name)==="webnn"){if(u.shouldTransferToMLTensor=!1,typeof L!="string"){let F=L,ne=F?.context,se=F?.gpuDevice,ee=F?.deviceType,te=F?.powerPreference;ne?u.currentContext=ne:se?u.currentContext=await u.webnnCreateMLContext(se):u.currentContext=await u.webnnCreateMLContext({deviceType:ee,powerPreference:te})}else u.currentContext=await u.webnnCreateMLContext();break}p=await u._OrtCreateSession(l,i,c),u.webgpuOnCreateSession?.(p),p===0&&z("Can't create a session."),u.jsepOnCreateSession?.(),u.currentContext&&(u.webnnRegisterMLContext(p,u.currentContext),u.currentContext=void 0,u.shouldTransferToMLTensor=!0);let[C,_]=ya(p),O=!!o?.enableGraphCapture,R=[],$=[],j=[],M=[],U=[];for(let L=0;L<C;L++){let[F,ne,se]=qr(p,L);F===0&&z("Can't get an input name."),b.push(F);let ee=u.UTF8ToString(F);R.push(ee),j.push(ne===0?{name:ee,isTensor:!1}:{name:ee,isTensor:!0,type:Xt(ne),shape:se})}for(let L=0;L<_;L++){let[F,ne,se]=qr(p,L+C);F===0&&z("Can't get an output name."),v.push(F);let ee=u.UTF8ToString(F);$.push(ee),M.push(ne===0?{name:ee,isTensor:!1}:{name:ee,isTensor:!0,type:Xt(ne),shape:se});{if(O&&o?.preferredOutputLocation===void 0){U.push("gpu-buffer");continue}let te=typeof o?.preferredOutputLocation=="string"?o.preferredOutputLocation:o?.preferredOutputLocation?.[ee]??"cpu",ie=u.webnnIsGraphOutput;if(te==="cpu"&&ie&&ie(p,ee)){U.push("ml-tensor-cpu-output");continue}if(te!=="cpu"&&te!=="cpu-pinned"&&te!=="gpu-buffer"&&te!=="ml-tensor")throw new Error(`Not supported preferred output location: ${te}.`);if(O&&te!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${te}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);U.push(te)}}let N=null;return U.some(L=>L==="gpu-buffer"||L==="ml-tensor"||L==="ml-tensor-cpu-output")&&(d=u._OrtCreateBinding(p),d===0&&z("Can't create IO binding."),N={handle:d,outputPreferredLocations:U,outputPreferredLocationsEncoded:U.map(L=>L==="ml-tensor-cpu-output"?"ml-tensor":L).map(L=>Kr(L))}),Ve.set(p,[p,b,v,N,O,!1]),[p,R,$,j,M]}catch(C){throw b.forEach(_=>u._OrtFree(_)),v.forEach(_=>u._OrtFree(_)),d!==0&&u._OrtReleaseBinding(d)!==0&&z("Can't release IO binding."),p!==0&&u._OrtReleaseSession(p)!==0&&z("Can't release session."),C}finally{u._free(l),c!==0&&u._OrtReleaseSessionOptions(c)!==0&&z("Can't release session options."),y.forEach(C=>u._free(C)),u.unmountExternalData?.()}},mn=n=>{let o=H(),l=Ve.get(n);if(!l)throw new Error(`cannot release session. invalid session id: ${n}`);let[i,u,p,c,d]=l;c&&(d&&o._OrtClearBoundOutputs(c.handle)!==0&&z("Can't clear bound outputs."),o._OrtReleaseBinding(c.handle)!==0&&z("Can't release IO binding.")),o.jsepOnReleaseSession?.(n),o.webnnOnReleaseSession?.(n),o.webgpuOnReleaseSession?.(n),u.forEach(y=>o._OrtFree(y)),p.forEach(y=>o._OrtFree(y)),o._OrtReleaseSession(i)!==0&&z("Can't release session."),Ve.delete(n)},Zr=async(n,o,l,i,u,p,c=!1)=>{if(!n){o.push(0);return}let d=H(),y=d.PTR_SIZE,b=n[0],v=n[1],C=n[3],_=C,O,R;if(b==="string"&&(C==="gpu-buffer"||C==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(c&&C!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${p} when enableGraphCapture is true.`);if(C==="gpu-buffer"){let M=n[2].gpuBuffer;R=ft(Qe(b),v);{let U=d.webgpuRegisterBuffer;if(!U)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');O=U(M,i)}}else if(C==="ml-tensor"){let M=n[2].mlTensor;R=ft(Qe(b),v);let U=d.webnnRegisterMLTensor;if(!U)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');O=U(i,M,Qe(b),v)}else{let M=n[2];if(Array.isArray(M)){R=y*M.length,O=d._malloc(R),l.push(O);for(let U=0;U<M.length;U++){if(typeof M[U]!="string")throw new TypeError(`tensor data at index ${U} is not a string`);d.setValue(O+U*y,ye(M[U],l),"*")}}else{let U=d.webnnIsGraphInput,N=d.webnnIsGraphOutput;if(b!=="string"&&U&&N){let L=d.UTF8ToString(u);if(U(i,L)||N(i,L)){let F=Qe(b);R=ft(F,v),_="ml-tensor";let ne=d.webnnCreateTemporaryTensor,se=d.webnnUploadTensor;if(!ne||!se)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let ee=await ne(i,F,v);se(ee,new Uint8Array(M.buffer,M.byteOffset,M.byteLength)),O=ee}else R=M.byteLength,O=d._malloc(R),l.push(O),d.HEAPU8.set(new Uint8Array(M.buffer,M.byteOffset,R),O)}else R=M.byteLength,O=d._malloc(R),l.push(O),d.HEAPU8.set(new Uint8Array(M.buffer,M.byteOffset,R),O)}}let $=d.stackSave(),j=d.stackAlloc(4*v.length);try{v.forEach((U,N)=>d.setValue(j+N*y,U,y===4?"i32":"i64"));let M=d._OrtCreateTensor(Qe(b),O,R,j,v.length,Kr(_));M===0&&z(`Can't create tensor for input/output. session=${i}, index=${p}.`),o.push(M)}finally{d.stackRestore($)}},gn=async(n,o,l,i,u,p)=>{let c=H(),d=c.PTR_SIZE,y=Ve.get(n);if(!y)throw new Error(`cannot run inference. invalid session id: ${n}`);let b=y[0],v=y[1],C=y[2],_=y[3],O=y[4],R=y[5],$=o.length,j=i.length,M=0,U=[],N=[],L=[],F=[],ne=c.stackSave(),se=c.stackAlloc($*d),ee=c.stackAlloc($*d),te=c.stackAlloc(j*d),ie=c.stackAlloc(j*d);try{[M,U]=za(p),Ke("wasm prepareInputOutputTensor");for(let P=0;P<$;P++)await Zr(l[P],N,F,n,v[o[P]],o[P],O);for(let P=0;P<j;P++)await Zr(u[P],L,F,n,C[i[P]],$+i[P],O);et("wasm prepareInputOutputTensor");for(let P=0;P<$;P++)c.setValue(se+P*d,N[P],"*"),c.setValue(ee+P*d,v[o[P]],"*");for(let P=0;P<j;P++)c.setValue(te+P*d,L[P],"*"),c.setValue(ie+P*d,C[i[P]],"*");if(_&&!R){let{handle:P,outputPreferredLocations:we,outputPreferredLocationsEncoded:nt}=_;if(v.length!==$)throw new Error(`input count from feeds (${$}) is expected to be always equal to model's input count (${v.length}).`);Ke("wasm bindInputsOutputs");for(let k=0;k<$;k++){let ae=o[k];await c._OrtBindInput(P,v[ae],N[k])!==0&&z(`Can't bind input[${k}] for session=${n}.`)}for(let k=0;k<j;k++){let ae=i[k];u[k]?.[3]?c._OrtBindOutput(P,C[ae],L[k],0)!==0&&z(`Can't bind pre-allocated output[${k}] for session=${n}.`):c._OrtBindOutput(P,C[ae],0,nt[ae])!==0&&z(`Can't bind output[${k}] to ${we[k]} for session=${n}.`)}et("wasm bindInputsOutputs"),Ve.set(n,[b,v,C,_,O,!0])}c.jsepOnRunStart?.(b),c.webnnOnRunStart?.(b);let X;_?X=await c._OrtRunWithBinding(b,_.handle,j,te,M):X=await c._OrtRun(b,ee,se,$,ie,j,te,M),X!==0&&z("failed to call OrtRun().");let ge=[],yt=[];Ke("wasm ProcessOutputTensor");for(let P=0;P<j;P++){let we=Number(c.getValue(te+P*d,"*"));if(we===L[P]){ge.push(u[P]);continue}let nt=c.stackSave(),k=c.stackAlloc(4*d),ae=!1,K,re=0;try{c._OrtGetTensorData(we,k,k+d,k+2*d,k+3*d)!==0&&z(`Can't access output tensor data on index ${P}.`);let Y=d===4?"i32":"i64",xe=Number(c.getValue(k,Y));re=c.getValue(k+d,"*");let it=c.getValue(k+d*2,"*"),I=Number(c.getValue(k+d*3,Y)),x=[];for(let J=0;J<I;J++)x.push(Number(c.getValue(it+J*d,Y)));c._OrtFree(it)!==0&&z("Can't free memory for tensor dims.");let be=x.reduce((J,W)=>J*W,1);K=Xt(xe);let pe=_?.outputPreferredLocations[i[P]];if(K==="string"){if(pe==="gpu-buffer"||pe==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let J=[];for(let W=0;W<be;W++){let ve=c.getValue(re+W*d,"*"),He=c.getValue(re+(W+1)*d,"*"),Re=W===be-1?void 0:He-ve;J.push(c.UTF8ToString(ve,Re))}ge.push([K,x,J,"cpu"])}else if(pe==="gpu-buffer"&&be>0){let J=c.webgpuGetBuffer;if(!J)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let W=J(re),ve=ft(xe,be);if(ve===void 0||!fn(K))throw new Error(`Unsupported data type: ${K}`);ae=!0;{c.webgpuRegisterBuffer(W,n,re);let He=c.webgpuCreateDownloader(W,ve,n);ge.push([K,x,{gpuBuffer:W,download:async()=>{let Re=await He();return new(St(K))(Re)},dispose:()=>{c._OrtReleaseTensor(we)!==0&&z("Can't release tensor.")}},"gpu-buffer"])}}else if(pe==="ml-tensor"&&be>0){let J=c.webnnEnsureTensor,W=c.webnnIsGraphInputOutputTypeSupported;if(!J||!W)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(ft(xe,be)===void 0||!dn(K))throw new Error(`Unsupported data type: ${K}`);if(!W(n,K,!1))throw new Error(`preferredLocation "ml-tensor" for ${K} output is not supported by current WebNN Context.`);let ve=await J(n,re,xe,x,!1);ae=!0,ge.push([K,x,{mlTensor:ve,download:c.webnnCreateMLTensorDownloader(re,K),dispose:()=>{c.webnnReleaseTensorId(re),c._OrtReleaseTensor(we)}},"ml-tensor"])}else if(pe==="ml-tensor-cpu-output"&&be>0){let J=c.webnnCreateMLTensorDownloader(re,K)(),W=ge.length;ae=!0,yt.push((async()=>{let ve=[W,await J];return c.webnnReleaseTensorId(re),c._OrtReleaseTensor(we),ve})()),ge.push([K,x,[],"cpu"])}else{let J=St(K),W=new J(be);new Uint8Array(W.buffer,W.byteOffset,W.byteLength).set(c.HEAPU8.subarray(re,re+W.byteLength)),ge.push([K,x,W,"cpu"])}}finally{c.stackRestore(nt),K==="string"&&re&&c._free(re),ae||c._OrtReleaseTensor(we)}}_&&!O&&(c._OrtClearBoundOutputs(_.handle)!==0&&z("Can't clear bound outputs."),Ve.set(n,[b,v,C,_,O,!1]));for(let[P,we]of await Promise.all(yt))ge[P][2]=we;return et("wasm ProcessOutputTensor"),ge}finally{c.webnnOnRunEnd?.(b),c.stackRestore(ne),l.forEach(X=>{X&&X[3]==="gpu-buffer"&&c.webgpuUnregisterBuffer(X[2].gpuBuffer)}),u.forEach(X=>{X&&X[3]==="gpu-buffer"&&c.webgpuUnregisterBuffer(X[2].gpuBuffer)}),N.forEach(X=>c._OrtReleaseTensor(X)),L.forEach(X=>c._OrtReleaseTensor(X)),F.forEach(X=>c._free(X)),M!==0&&c._OrtReleaseRunOptions(M),U.forEach(X=>c._free(X))}},wn=n=>{let o=H(),l=Ve.get(n);if(!l)throw new Error("invalid session id");let i=l[0],u=o._OrtEndProfiling(i);u===0&&z("Can't get an profile file name."),o._OrtFree(u)},bn=n=>{let o=[];for(let l of n){let i=l[2];!Array.isArray(i)&&"buffer"in i&&o.push(i.buffer)}return o}}),ze,Ee,ut,At,Ot,qt,Xr,Zt,Xe,Ye,ma,to,ro,no,io,ao,oo,so,lo=D(()=>{tt(),eo(),rt(),sn(),ze=()=>!!Z.wasm.proxy&&typeof document<"u",ut=!1,At=!1,Ot=!1,Zt=new Map,Xe=(n,o)=>{let l=Zt.get(n);l?l.push(o):Zt.set(n,[o])},Ye=()=>{if(ut||!At||Ot||!Ee)throw new Error("worker not ready")},ma=n=>{switch(n.data.type){case"init-wasm":ut=!1,n.data.err?(Ot=!0,Xr[1](n.data.err)):(At=!0,Xr[0]()),qt&&(URL.revokeObjectURL(qt),qt=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let o=Zt.get(n.data.type);n.data.err?o.shift()[1](n.data.err):o.shift()[0](n.data.out);break}}},to=async()=>{if(!At){if(ut)throw new Error("multiple calls to 'initWasm()' detected.");if(Ot)throw new Error("previous call to 'initWasm()' failed.");if(ut=!0,ze())return new Promise((n,o)=>{Ee?.terminate(),Fa().then(([l,i])=>{try{Ee=i,Ee.onerror=p=>o(p),Ee.onmessage=ma,Xr=[n,o];let u={type:"init-wasm",in:Z};!u.in.wasm.wasmPaths&&(l||Qr)&&(u.in.wasm.wasmPaths={wasm:new URL("/slate/assets/ort-wasm-simd-threaded.asyncify-BJtBjfiH.wasm",import.meta.url).href}),Ee.postMessage(u),qt=l}catch(u){o(u)}},o)});try{await ln(Z.wasm),await cn(Z),At=!0}catch(n){throw Ot=!0,n}finally{ut=!1}}},ro=async n=>{if(ze())return Ye(),new Promise((o,l)=>{Xe("init-ep",[o,l]);let i={type:"init-ep",in:{epName:n,env:Z}};Ee.postMessage(i)});await hn(Z,n)},no=async n=>ze()?(Ye(),new Promise((o,l)=>{Xe("copy-from",[o,l]);let i={type:"copy-from",in:{buffer:n}};Ee.postMessage(i,[n.buffer])})):Kt(n),io=async(n,o)=>{if(ze()){if(o?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return Ye(),new Promise((l,i)=>{Xe("create",[l,i]);let u={type:"create",in:{model:n,options:{...o}}},p=[];n instanceof Uint8Array&&p.push(n.buffer),Ee.postMessage(u,p)})}else return yn(n,o)},ao=async n=>{if(ze())return Ye(),new Promise((o,l)=>{Xe("release",[o,l]);let i={type:"release",in:n};Ee.postMessage(i)});mn(n)},oo=async(n,o,l,i,u,p)=>{if(ze()){if(l.some(c=>c[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(u.some(c=>c))throw new Error("pre-allocated output tensor is not supported for proxy.");return Ye(),new Promise((c,d)=>{Xe("run",[c,d]);let y=l,b={type:"run",in:{sessionId:n,inputIndices:o,inputs:y,outputIndices:i,options:p}};Ee.postMessage(b,bn(y))})}else return gn(n,o,l,i,u,p)},so=async n=>{if(ze())return Ye(),new Promise((o,l)=>{Xe("end-profiling",[o,l]);let i={type:"end-profiling",in:n};Ee.postMessage(i)});wn(n)}}),Yr,ga,uo,Zl=D(()=>{tt(),lo(),ht(),on(),qa(),Yr=(n,o)=>{switch(n.location){case"cpu":return[n.type,n.dims,n.data,"cpu"];case"gpu-buffer":return[n.type,n.dims,{gpuBuffer:n.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[n.type,n.dims,{mlTensor:n.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${n.location} for ${o()}`)}},ga=n=>{switch(n[3]){case"cpu":return new Be(n[0],n[2],n[1]);case"gpu-buffer":{let o=n[0];if(!fn(o))throw new Error(`not supported data type: ${o} for deserializing GPU tensor`);let{gpuBuffer:l,download:i,dispose:u}=n[2];return Be.fromGpuBuffer(l,{dataType:o,dims:n[1],download:i,dispose:u})}case"ml-tensor":{let o=n[0];if(!dn(o))throw new Error(`not supported data type: ${o} for deserializing MLTensor tensor`);let{mlTensor:l,download:i,dispose:u}=n[2];return Be.fromMLTensor(l,{dataType:o,dims:n[1],download:i,dispose:u})}default:throw new Error(`invalid data location: ${n[3]}`)}},uo=class{async fetchModelAndCopyToWasmMemory(n){return no(await pn(n))}async loadModel(n,o){pt();let l;typeof n=="string"?l=await this.fetchModelAndCopyToWasmMemory(n):l=n,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await io(l,o),ct()}async dispose(){return ao(this.sessionId)}async run(n,o,l){pt();let i=[],u=[];Object.entries(n).forEach(C=>{let _=C[0],O=C[1],R=this.inputNames.indexOf(_);if(R===-1)throw new Error(`invalid input '${_}'`);i.push(O),u.push(R)});let p=[],c=[];Object.entries(o).forEach(C=>{let _=C[0],O=C[1],R=this.outputNames.indexOf(_);if(R===-1)throw new Error(`invalid output '${_}'`);p.push(O),c.push(R)});let d=i.map((C,_)=>Yr(C,()=>`input "${this.inputNames[u[_]]}"`)),y=p.map((C,_)=>C?Yr(C,()=>`output "${this.outputNames[c[_]]}"`):null),b=await oo(this.sessionId,u,d,c,y,l),v={};for(let C=0;C<b.length;C++)v[this.outputNames[c[C]]]=p[C]??ga(b[C]);return ct(),v}startProfiling(){}endProfiling(){so(this.sessionId)}}}),fo={};Ut(fo,{OnnxruntimeWebAssemblyBackend:()=>rn,initializeFlags:()=>tn,wasmBackend:()=>po});var tn,rn,po,Xl=D(()=>{tt(),lo(),Zl(),tn=()=>{(typeof Z.wasm.initTimeout!="number"||Z.wasm.initTimeout<0)&&(Z.wasm.initTimeout=0);let n=Z.wasm.simd;if(typeof n!="boolean"&&n!==void 0&&n!=="fixed"&&n!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${n}". Reset it to \`false\` and ignore SIMD feature checking.`),Z.wasm.simd=!1),typeof Z.wasm.proxy!="boolean"&&(Z.wasm.proxy=!1),typeof Z.wasm.trace!="boolean"&&(Z.wasm.trace=!1),typeof Z.wasm.numThreads!="number"||!Number.isInteger(Z.wasm.numThreads)||Z.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)Z.wasm.numThreads=1;else{let o=typeof navigator>"u"?Al("node:os").cpus().length:navigator.hardwareConcurrency;Z.wasm.numThreads=Math.min(4,Math.ceil((o||1)/2))}},rn=class{async init(n){tn(),await to(),await ro(n)}async createInferenceSessionHandler(n,o){let l=new uo;return await l.loadModel(n,o),l}},po=new rn});tt();tt();tt();var Yl="1.23.2",Jl=$a;{let n=(Xl(),Yt(fo)).wasmBackend;dt("webgpu",n,5),dt("webnn",n,5),dt("cpu",n,10),dt("wasm",n,10)}Object.defineProperty(Z.versions,"web",{value:Yl,enumerable:!0});export{Pa as InferenceSession,Jr as TRACE,Ke as TRACE_EVENT_BEGIN,et as TRACE_EVENT_END,pt as TRACE_FUNC_BEGIN,ct as TRACE_FUNC_END,Be as Tensor,Jl as default,Z as env,dt as registerBackend};
